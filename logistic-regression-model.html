<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Logistic regression model | Data Analytics" />
<meta property="og:type" content="book" />





<meta name="author" content="Shuai Huang &amp; Houtao Deng" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Logistic regression model | Data Analytics">

<title>Logistic regression model | Data Analytics</title>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<script src="https://use.typekit.net/ajy6rnl.js"></script>
<script>try{Typekit.load({ async: true });}catch(e){}</script>
<!-- <link rel="stylesheet" href="css/normalize.css"> -->
<!-- <link rel="stylesheet" href="css/envisioned.css"/> -->
<link rel="stylesheet" href="css/tablesaw-stackonly.css"/>
<link rel="stylesheet" href="css/nudge.css"/>
<link rel="stylesheet" href="css/sourcesans.css"/>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>




</head>

<body>

<!--bookdown:toc:start-->

<nav class="pushy pushy-left" id="TOC">
<ul>
<li><a href="#preface">Preface</a></li>
<li><a href="#acknowledgments">Acknowledgments</a></li>
<li><a href="#chapter-1.-introduction">Chapter 1. Introduction</a></li>
<li><a href="#chapter-2.-abstraction-regression-tree-models">Chapter 2. Abstraction: Regression &amp; Tree Models</a></li>
<li><a href="#chapter-3.-recognition-logistic-regression-ranking">Chapter 3. Recognition: Logistic Regression &amp; Ranking</a></li>
<li><a href="#chapter-4.-resonance-bootstrap-random-forests">Chapter 4. Resonance: Bootstrap &amp; Random Forests</a></li>
<li><a href="#chapter-5.-learning-i-cross-validation-oob">Chapter 5. Learning (I): Cross-validation &amp; OOB</a></li>
<li><a href="#chapter-6.-diagnosis-residuals-heterogeneity">Chapter 6. Diagnosis: Residuals &amp; Heterogeneity</a></li>
<li><a href="#chapter-7.-learning-ii-svm-ensemble-learning">Chapter 7. Learning (II): SVM &amp; Ensemble Learning</a></li>
<li><a href="#chapter-8.-scalability-lasso-pca">Chapter 8. Scalability: LASSO &amp; PCA</a></li>
<li><a href="#chapter-9.-pragmatism-experience-experimental">Chapter 9. Pragmatism: Experience &amp; Experimental</a></li>
<li><a href="#chapter-10.-synthesis-architecture-pipeline">Chapter 10. Synthesis: Architecture &amp; Pipeline</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#appendix-a-brief-review-of-background-knowledge">Appendix: A Brief Review of Background Knowledge</a></li>
</ul>
</nav>

<!--bookdown:toc:end-->

<div class="menu-btn"><h3>☰ Menu</h3></div>

<div class="site-overlay"></div>


<div class="row">
<div class="col-sm-12">

<nav class="pushy pushy-left" id="TOC">
<ul>
<li><a href="index.html#preface">Preface</a></li>
<li><a href="acknowledgments.html#acknowledgments">Acknowledgments</a></li>
<li><a href="chapter-1-introduction.html#chapter-1.-introduction">Chapter 1. Introduction</a></li>
<li><a href="chapter-2-abstraction-regression-tree-models.html#chapter-2.-abstraction-regression-tree-models">Chapter 2. Abstraction: Regression &amp; Tree Models</a></li>
<li><a href="chapter-3-recognition-logistic-regression-ranking.html#chapter-3.-recognition-logistic-regression-ranking">Chapter 3. Recognition: Logistic Regression &amp; Ranking</a></li>
<li><a href="chapter-4-resonance-bootstrap-random-forests.html#chapter-4.-resonance-bootstrap-random-forests">Chapter 4. Resonance: Bootstrap &amp; Random Forests</a></li>
<li><a href="chapter-5-learning-i-cross-validation-oob.html#chapter-5.-learning-i-cross-validation-oob">Chapter 5. Learning (I): Cross-validation &amp; OOB</a></li>
<li><a href="chapter-6-diagnosis-residuals-heterogeneity.html#chapter-6.-diagnosis-residuals-heterogeneity">Chapter 6. Diagnosis: Residuals &amp; Heterogeneity</a></li>
<li><a href="chapter-7-learning-ii-svm-ensemble-learning.html#chapter-7.-learning-ii-svm-ensemble-learning">Chapter 7. Learning (II): SVM &amp; Ensemble Learning</a></li>
<li><a href="chapter-8-scalability-lasso-pca.html#chapter-8.-scalability-lasso-pca">Chapter 8. Scalability: LASSO &amp; PCA</a></li>
<li><a href="chapter-9-pragmatism-experience-experimental.html#chapter-9.-pragmatism-experience-experimental">Chapter 9. Pragmatism: Experience &amp; Experimental</a></li>
<li><a href="chapter-10-synthesis-architecture-pipeline.html#chapter-10.-synthesis-architecture-pipeline">Chapter 10. Synthesis: Architecture &amp; Pipeline</a></li>
<li><a href="conclusion.html#conclusion">Conclusion</a></li>
<li><a href="appendix-a-brief-review-of-background-knowledge.html#appendix-a-brief-review-of-background-knowledge">Appendix: A Brief Review of Background Knowledge</a></li>
</ul>
</nav>

</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="logistic-regression-model" class="section level2 unnumbered">
<h2>Logistic regression model</h2>
<div id="rationale-and-formulation-2" class="section level3 unnumbered">
<h3>Rationale and formulation</h3>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-lrgoal1"></span>
<img src="graphics/3_lrgoal1.png" alt="Direct application of linear regression on binary outcome, i.e., illustration of Eq. \@ref(eq:3-goal1) on a one-predictor problem where $x$ is the dose of a treatment and $y$ is the binary outcome variable." width="250px"  />
<!--
<p class="caption marginnote">-->Figure 25: Direct application of linear regression on binary outcome, i.e., illustration of Eq. <a href="logistic-regression-model.html#eq:3-goal1">(23)</a> on a one-predictor problem where <span class="math inline">\(x\)</span> is the dose of a treatment and <span class="math inline">\(y\)</span> is the binary outcome variable.<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>Linear regression models are introduced in <strong>Chapter 2</strong> as a tool to predict a continuous response using a few input variables. In some applications, the response variable is a binary variable that denotes two classes. For example, in the AD dataset, we have a variable called <code>DX_bl</code> that encodes the diagnosis information of the subjects, i.e., <code>0</code> denotes <em>normal</em>, while <code>1</code> denotes <em>diseased</em>.</p>
<p>We have learned about linear regression models to connect the input variables with the outcome variable. It is natural to wonder if the linear regression framework could still be useful here. If we write the regression equation</p>
<p><span class="math display" id="eq:3-goal1">\[\begin{equation}
    \text{The goal: } \underbrace{y}_{\text{Binary}}=\underbrace{\beta_{0}+\sum_{i=1}^{p} \beta_{i} x_{i}+\varepsilon.}_{\text{Continuous and unbounded}}
\tag{23}
\end{equation}\]</span></p>
<p>Something doesn’t make sense. The reason is obvious: the right-hand side of Eq. <a href="logistic-regression-model.html#eq:3-goal1">(23)</a> is continuous without bounds, while the left hand side of the equation is a binary variable. A graphical illustration is shown in Figure <a href="logistic-regression-model.html#fig:f3-lrgoal1">25</a>. So we have to modify this equation, either the right-hand side or the left-hand side.</p>
<p>Since we want it to be a linear model, it is better not to modify the right-hand side. So look at the left-hand side. Why we have to stick with the natural scale of <span class="math inline">\(y\)</span>? We could certainly work out a more linear-model-friendly scale. For example, instead of predicting <span class="math inline">\(y\)</span>, how about predicting the probability <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span>? If we know <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span>, we can certainly convert it to the scale of <span class="math inline">\(y\)</span>.<label for="tufte-sn-53" class="margin-toggle sidenote-number">53</label><input type="checkbox" id="tufte-sn-53" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">53</span> I.e., if <span class="math inline">\(Pr(y=1|\boldsymbol{x}) \geq 0.5\)</span>, we conclude <span class="math inline">\(y = 1\)</span>; otherwise, <span class="math inline">\(y=0\)</span>.</span></p>
<p>Thus, we consider the following revised goal</p>
<p><span class="math display" id="eq:3-goal2">\[\begin{equation}
    \text{Revised goal: } \underbrace{Pr(y=1|\boldsymbol{x})}_{\text{Continuous but bounded}}=\underbrace{\beta_{0}+\sum_{i=1}^{p} \beta_{i} x_{i}+\varepsilon.}_{\text{Continuous and unbounded}}
\tag{24}
\end{equation}\]</span></p>
<p>Changing our outcome variable from <span class="math inline">\(y\)</span> to <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span> is a good move, since <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span> is on a continuous scale. However, as it is a probability, it has to be in the range of <span class="math inline">\([0,1]\)</span>. We need more modifications to make things work.</p>
<p>If we make a lot of modifications and things barely work, we may have lost the essence. What is the essence of the linear model that we would like to leverage in this binary prediction problem? Interpretability—sure, the linear form seems easy to understand, but as we have pointed out in <strong>Chapter 2</strong>, this interpretability comes with a price, and we need to be cautious when we draw conclusions about the linear model, although there are easy conventions for us to follow. On the other hand, it would sound absurd if we dig into the literature and found there had been no <em>linear model</em> for binary classification problems. Linear model is the baseline of the data analytics enterprise. It is the starting point of our data analytics adventure. That is how important it is.</p>
<p>Back to the business to modify the linear formalism for a binary classification problem. Now our outcome variable is <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span>, and we realize it still doesn’t match with the linear form <span class="math inline">\(\beta_0+\sum_{i=1}^p \beta_i x_i\)</span>. What is the essential task here? If we put the puzzle in a context, it may give us some hints. For example, if our goal is to predict the risk of Alzheimer’s disease for subjects who are aged <span class="math inline">\(65\)</span> years or older, we have known the average risk from recent national statistics is <span class="math inline">\(8.8\%\)</span>. Now if we have a group of individuals who are aged 65 years or older, we could make a risk prediction for them <em>as a group</em>, i.e., 8.8%. But this is not the best we could do for each <em>individual</em>. We could examine an individual’s characteristics such as the gene <em>APOE</em><label for="tufte-sn-54" class="margin-toggle sidenote-number">54</label><input type="checkbox" id="tufte-sn-54" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">54</span> <em>APOE</em> polymorphic alleles play a major role in determining the risk of Alzheimer’s disease (AD): individuals carrying the <span class="math inline">\(\epsilon4\)</span> allele are at increased risk of AD compared with those carrying the more common <span class="math inline">\(\epsilon3\)</span> allele, whereas the <span class="math inline">\(\epsilon2\)</span> allele decreases risk.</span> and see if an individual has higher (or lower) risk than the average. Now comes the inspiration: what if we can <em>rank</em> the risk of the individuals based on their characteristics, can it help with the final goal that is to predict the outcome variable <span class="math inline">\(y\)</span>?</p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-lrgoal2"></span>
<img src="graphics/3_lrgoal2.png" alt="Application of the **logistic function** on binary outcome" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 26: Application of the <strong>logistic function</strong> on binary outcome<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>Now we look closer into the idea of a linear form, and we realize it is more useful in <em>ranking</em> the possibilities rather than directly being eligible probabilities.</p>
<p><span class="math display" id="eq:3-goal3">\[\begin{equation}
    \text{Revised goal: } Pr(y=1|\boldsymbol{x})\propto\beta_0+\sum_{i=1}^p\, \beta_i x_i.
\tag{25}
\end{equation}\]</span></p>
<p>In other words, a linear form can make a comparison of two inputs, say, <span class="math inline">\(\boldsymbol{x}_i\)</span> and <span class="math inline">\(\boldsymbol{x}_j\)</span>, and evaluates which one leads to a higher probability of <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span>.</p>
<p>It is fine that we use the linear form to generate numerical values that rank the subjects. We just need one more step to transform those ranks into probabilities. Statisticians have found that the <strong>logistic function</strong> is suitable here for the transformation</p>
<p><span class="math display" id="eq:3-pry1">\[\begin{equation}
    Pr(y=1|\boldsymbol{x}) = \frac{1}{1+e^{-\left(\beta_0+\sum\nolimits_{i=1}\nolimits^{p}\, \beta_i x_i\right)}}.
\tag{26}
\end{equation}\]</span></p>
<p>Figure <a href="logistic-regression-model.html#fig:f3-lrgoal2">26</a> shows that the <em>logistic function</em> indeed provides a better fit of the data than the linear function as shown in Figure <a href="logistic-regression-model.html#fig:f3-lrgoal1">25</a>.</p>
<p>Eq. <a href="logistic-regression-model.html#eq:3-pry1">(26)</a> can be rewritten as Eq. <a href="logistic-regression-model.html#eq:3-logitR">(27)</a></p>
<p><span class="math display" id="eq:3-logitR">\[\begin{equation}
    \log {\frac{Pr(y=1|\boldsymbol{x})}{1-Pr(y=1|\boldsymbol{x})}}=\beta_0+\sum\nolimits_{i=1}\nolimits^{p}\beta_i x_i.
\tag{27}
\end{equation}\]</span></p>
<p>This is the so-called <strong>logistic regression</strong> model. The name stems from the transformation of <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span> used here, i.e., the <span class="math inline">\(\log \frac{Pr(y=1|\boldsymbol{x})}{1-Pr(y=1|\boldsymbol{x})}\)</span>, which is the logistic transformation that has been widely used in many areas such as physics and signal processing.</p>
<p>Note that we have mentioned that we can predict <span class="math inline">\(y=1\)</span> if <span class="math inline">\(Pr(y=1|\boldsymbol{x})\geq0.5\)</span>, and <span class="math inline">\(y=0\)</span> if <span class="math inline">\(Pr(y=1|\boldsymbol{x})&lt;0.5\)</span>. While <span class="math inline">\(0.5\)</span> seems naturally a cut-off value here, it is not necessarily optimal in every application. We could use the techniques discussed in <strong>Chapter 5</strong> such as cross-validation to decide what is the optimal cut-off value in practice.</p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-discretize"></span>
<img src="graphics/3_discretize.png" alt="Illustration of the discretization process, e.g., two categories ($0.0-0.1$ and $0.1-0.2$) of $x$ are shown" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 27: Illustration of the discretization process, e.g., two categories (<span class="math inline">\(0.0-0.1\)</span> and <span class="math inline">\(0.1-0.2\)</span>) of <span class="math inline">\(x\)</span> are shown<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p><em>Visual inspection of data.</em> How do we know that our data could be characterized using a logistic function?</p>
<p>We can <em>discretize</em> the predictor <span class="math inline">\(x\)</span> in Figure <a href="logistic-regression-model.html#fig:f3-lrgoal2">26</a> into a few categories, compute the empirical estimate of <span class="math inline">\(Pr(y=1|x)\)</span> in each category, and create a new data table. This procedure is illustrated in Figure <a href="logistic-regression-model.html#fig:f3-discretize">27</a>.</p>
<p>Suppose that we discretize the data in Figure <a href="logistic-regression-model.html#fig:f3-lrgoal2">26</a> and obtain the result as shown in Table <a href="logistic-regression-model.html#tab:t3-goal3">6</a>.</p>
<p></p>
<p><!--
<caption>--><span class="marginnote shownote"><span id="tab:t3-goal3">Table 6: </span>Example of a result after discretization</span><!--</caption>--></p>
<table>
<thead>
<tr class="header">
<th align="left">Level of <span class="math inline">\(x\)</span></th>
<th align="left"><span class="math inline">\(1\)</span></th>
<th align="left"><span class="math inline">\(2\)</span></th>
<th align="left"><span class="math inline">\(3\)</span></th>
<th align="left"><span class="math inline">\(4\)</span></th>
<th align="left"><span class="math inline">\(5\)</span></th>
<th align="left"><span class="math inline">\(6\)</span></th>
<th align="left"><span class="math inline">\(7\)</span></th>
<th align="left"><span class="math inline">\(8\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(Pr(y=1\)</span>|<span class="math inline">\(x)\)</span></td>
<td align="left"><span class="math inline">\(0.00\)</span></td>
<td align="left"><span class="math inline">\(0.04\)</span></td>
<td align="left"><span class="math inline">\(0.09\)</span></td>
<td align="left"><span class="math inline">\(0.20\)</span></td>
<td align="left"><span class="math inline">\(0.59\)</span></td>
<td align="left"><span class="math inline">\(0.89\)</span></td>
<td align="left"><span class="math inline">\(0.92\)</span></td>
<td align="left"><span class="math inline">\(0.99\)</span></td>
</tr>
</tbody>
</table>
<p></p>
<p>Then, we revise the scale of the <span class="math inline">\(y\)</span>-axis of Figure <a href="logistic-regression-model.html#fig:f3-lrgoal2">26</a> to be <span class="math inline">\(Pr(y=1|x)\)</span>, and create Figure <a href="logistic-regression-model.html#fig:f3-lrgoal3">28</a>. It could be seen that the empirical curve does fit the form of Eq. <a href="logistic-regression-model.html#eq:3-pry1">(26)</a>.</p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-lrgoal3"></span>
<img src="graphics/3_lrgoal3.png" alt="Revised scale of the $y$-axis of Figure \@ref(fig:f3-lrgoal2), i.e., illustration of Eq. \@ref(eq:3-pry1) " width="250px"  />
<!--
<p class="caption marginnote">-->Figure 28: Revised scale of the <span class="math inline">\(y\)</span>-axis of Figure <a href="logistic-regression-model.html#fig:f3-lrgoal2">26</a>, i.e., illustration of Eq. <a href="logistic-regression-model.html#eq:3-pry1">(26)</a> <!--</p>-->
<!--</div>--></span>
</p>
<p></p>
</div>
<div id="theory-and-method-1" class="section level3 unnumbered">
<h3>Theory and method</h3>
<p>We collect data to estimate the regression parameters of the logistic regression in Eq. <a href="logistic-regression-model.html#eq:3-logitR">(27)</a>. Denote the sample size as <span class="math inline">\(N\)</span>. <span class="math inline">\(\boldsymbol{y} \in R^{N \times 1}\)</span> denotes the <span class="math inline">\(N\)</span> measurements of the outcome variable, and <span class="math inline">\(\boldsymbol{X} \in R^{N \times (p+1)}\)</span> denotes the data matrix that includes the <span class="math inline">\(N\)</span> measurements of the <span class="math inline">\(p\)</span> input variables plus the dummy variable for the intercept coefficient <span class="math inline">\(\beta_0\)</span>. As in a linear regression model, <span class="math inline">\(\boldsymbol{\beta}\)</span> is the column vector form of the regression parameters.</p>
<p><em>The likelihood function.</em> The <strong>likelihood function</strong> evaluates how well a given set of parameters fit the data<label for="tufte-sn-55" class="margin-toggle sidenote-number">55</label><input type="checkbox" id="tufte-sn-55" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">55</span> The <em>least squares</em> loss function we derived in <strong>Chapter 2</strong> could also be derived based on the likelihood function of a linear regression model.</span>. The likelihood function has a specific definition, i.e., the conditional probability of the data conditional on the given set of parameters. Here, the dataset is <span class="math inline">\(D = \left \{\boldsymbol{X}, \boldsymbol{y} \right\}\)</span>, so the likelihood function is defined as <span class="math inline">\(Pr(D | \boldsymbol{\beta})\)</span>. It could be broken down into <span class="math inline">\(N\)</span> components<label for="tufte-sn-56" class="margin-toggle sidenote-number">56</label><input type="checkbox" id="tufte-sn-56" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">56</span> Note that, it is assumed that <span class="math inline">\(D\)</span> consists of <span class="math inline">\(N\)</span> independent data points.</span></p>
<p><span class="math display">\[
Pr(D | \boldsymbol{\beta}) = \prod\nolimits_{n=1}\nolimits^{N}Pr(\boldsymbol{x}_n, {y_n} | \boldsymbol{\beta}).
\]</span></p>
<p>For data point <span class="math inline">\((\boldsymbol{x}_n, {y_n})\)</span>, the conditional probability <span class="math inline">\(Pr(\boldsymbol{x}_n, {y_n} | \boldsymbol{\beta})\)</span> is</p>
<div style="page-break-after: always;"></div>
<p><span class="math display">\[\begin{equation}
    Pr(\boldsymbol{x}_n, {y_n} | \boldsymbol{\beta})=\begin{cases}
    p(\boldsymbol{x}_n), &amp; if \, y_n = 1 \\
    1-p(\boldsymbol{x}_n), &amp; if \, y_n = 0. \\
    \end{cases}
\end{equation}\]</span></p>
<p>Here, <span class="math inline">\(p(\boldsymbol{x}_n) = Pr(y=1|\boldsymbol{x})\)</span>.</p>
<p>A succinct form to represent these two scenarios together is</p>
<p><span class="math display">\[Pr(\boldsymbol{x}_n, {y_n} | \boldsymbol{\beta}) = p(\boldsymbol{x}_n)^{y_n}\left[1-p(\boldsymbol{x}_n)\right]^{1-y_n}.\]</span></p>
<p>Then we can generalize this to all the <span class="math inline">\(N\)</span> data points, and derive the complete likelihood function as</p>
<p><span class="math display">\[
Pr(D | \boldsymbol{\beta})=\prod\nolimits_{n=1}\nolimits^{N}p(\boldsymbol{x}_n)^{y_n}\left[1-p(\boldsymbol{x}_n)\right]^{1-y_n}.
\]</span></p>
<p>It is common to write up its log-likelihood function , defined as <span class="math inline">\(l(\boldsymbol \beta) = \log Pr(D | \boldsymbol{\beta})\)</span>, to turn products into sums</p>
<p><span class="math display">\[l(\boldsymbol \beta)=\sum\nolimits_{n=1}\nolimits^N\, \left \{ y_n \log p(\boldsymbol{x}_n)+(1-y_n)\log [1-p(\boldsymbol{x}_n)]\right\}.\]</span></p>
<p>By plugging in the definition of <span class="math inline">\(p(\boldsymbol{x}_n)\)</span>, this could be further transformed into</p>
<p><span class="math display" id="eq:3-likelihood">\[\begin{equation}
\begin{split}
    l(\boldsymbol \beta) = \sum\nolimits_{n=1}\nolimits^N -\log \left(1+e^{\beta_0+\sum\nolimits_{i=1}\nolimits^p\, \beta_i x_{ni}} \right) - \\ \sum\nolimits_{n=1}\nolimits^N y_n(\beta_0+\sum\nolimits_{i=1}\nolimits^p\, \beta_i x_{ni}).
\end{split}
\tag{28}
\end{equation}\]</span></p>
<p>Note that, for any probabilistic model<label for="tufte-sn-57" class="margin-toggle sidenote-number">57</label><input type="checkbox" id="tufte-sn-57" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">57</span> A probabilistic model has a joint distribution for all the random variables concerned in the model. Interested readers can read this comprehensive book: Koller, D. and Friedman, N., <em>Probabilistic Graphical Models: Principles and Techniques</em>, The MIT Press, 2009.</span>, we could derive the likelihood function in one way or another, in a similar fashion as we have done for the logistic regression model.</p>
<p><em>Algorithm.</em> Eq. <a href="logistic-regression-model.html#eq:3-likelihood">(28)</a> provides the objective function of a maximization problem, i.e., the parameter that maximizes <span class="math inline">\(l(\boldsymbol \beta)\)</span> is the best parameter. Theoretically, we could use the First Derivative Test to find the optimal solution. The problem here is that there is no closed-form solution found if we directly apply the First Derivative Test.</p>
<p>Instead, the <strong>Newton-Raphson algorithm</strong> is commonly used to optimize the log-likelihood function of the logistic regression model. It is an iterative algorithm that starts from an <strong>initial solution</strong>, continues to seek updates of the current solution using the following formula</p>
<p><span class="math display" id="eq:3-newtonmethod">\[\begin{equation}
\boldsymbol \beta^{new} = \boldsymbol \beta^{old} - (\frac{\partial^2 l(\boldsymbol \beta)}{\partial \boldsymbol \beta \partial \boldsymbol \beta^T})^{-1} \frac{\partial l(\boldsymbol \beta)}{\partial \boldsymbol \beta}.
\tag{29}
\end{equation}\]</span></p>
<p>Here, <span class="math inline">\(\frac{\partial l(\boldsymbol \beta)}{\partial \boldsymbol \beta}\)</span> is the <strong>gradient</strong> of the current solution, that points to the <strong>direction</strong> following which we should increment the current solution to improve on the objective function. On the other hand, how far we should go along this direction is decided by the <strong>step size</strong> factor, defined as <span class="math inline">\((\frac{\partial^2 l(\boldsymbol \beta)}{\partial \boldsymbol \beta \partial \boldsymbol \beta^T})^{-1}\)</span>. Theoretical results have shown that this formula could converge to the optimal solution. An illustration is given in Figure <a href="logistic-regression-model.html#fig:f3-RWalgor">29</a>.</p>
<p></p>
<div class="figure"><span id="fig:f3-RWalgor"></span>
<p class="caption marginnote shownote">
Figure 29: Illustration of the gradient-based optimization algorithms that include the Newton-Raphson algorithm as an example. An algorithm starts from an initial solution (e.g., <span class="math inline">\(x_0\)</span> and <span class="math inline">\(x_0&#39;\)</span> are two examples of initial solutions in the figure), uses the gradient to find the <strong>direction</strong>, and moves the solution along that direction with the computed <strong>step size</strong>, until it finds the optimal solution <span class="math inline">\(x^*\)</span>.
</p>
<img src="graphics/3_RWalgor.png" alt="Illustration of the gradient-based optimization algorithms that include the Newton-Raphson algorithm as an example. An algorithm starts from an initial solution (e.g., $x_0$ and $x_0'$ are two examples of initial solutions in the figure), uses the gradient to find the **direction**, and moves the solution along that direction with the computed **step size**, until it finds the optimal solution $x^*$." width="100%"  />
</div>
<p></p>
<p>The Newton-Raphson algorithm presented in Eq. <a href="logistic-regression-model.html#eq:3-newtonmethod">(29)</a> is general. To apply it in a logistic regression model, since we have an explicit form of <span class="math inline">\(l(\boldsymbol \beta)\)</span>, we can derive the gradient and step size as shown below</p>
<p><span class="math display">\[\begin{align*}
    \frac{\partial l(\boldsymbol{\beta})}{\partial \boldsymbol{\beta}} &amp;= \sum\nolimits_{n=1}^{N}\boldsymbol{x}_n\left[y_n -p(\boldsymbol{x}_n)\right], \\
    \frac{\partial^2 l(\boldsymbol{\beta})}{\partial \boldsymbol{\beta} \partial \boldsymbol{\beta}^T} &amp;= -\sum\nolimits_{n=1}^N \boldsymbol{x}_n\boldsymbol{x}_n^T p(\boldsymbol{x}_n)\left[1-p(\boldsymbol{x}_n)\right].
\end{align*}\]</span></p>
<p>A certain structure can be revealed if we rewrite it in matrix form<label for="tufte-sn-58" class="margin-toggle sidenote-number">58</label><input type="checkbox" id="tufte-sn-58" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">58</span> <span class="math inline">\(\boldsymbol{p}(\boldsymbol{x})\)</span> is a <span class="math inline">\(N\times1\)</span> column vector of <span class="math inline">\(p(\boldsymbol{x}_n)\)</span>, and <span class="math inline">\(\boldsymbol{W}\)</span> is a <span class="math inline">\(N\times N\)</span> diagonal matrix with the <span class="math inline">\(n^{th}\)</span> diagonal element as <span class="math inline">\(p(\boldsymbol{x}_n )\left[1-p(\boldsymbol{x}_n)\right]\)</span>.</span></p>
<p><span class="math display" id="eq:3-gradient">\[\begin{align}
    \frac{\partial l(\boldsymbol{\beta})}{\partial \boldsymbol{\beta}} = \boldsymbol{X}^T\left[\boldsymbol{y}-\boldsymbol{p}(\boldsymbol{x})\right],  \\
    \frac{\partial^2 l(\boldsymbol{\beta})}{\boldsymbol{\beta} \boldsymbol{\beta}^T} = -\boldsymbol{X}^T\boldsymbol{W}\boldsymbol{X}.
    \tag{30}
\end{align}\]</span></p>
<p>Plugging Eq. <a href="logistic-regression-model.html#eq:3-gradient">(30)</a> into the updating formula as shown in Eq. <a href="logistic-regression-model.html#eq:3-newtonmethod">(29)</a>, we can derive a specific formula for logistic regression</p>
<p><span class="math display" id="eq:3-betaupdate">\[\begin{align}
    &amp;\boldsymbol{\beta}^{new} = \boldsymbol{\beta}^{old} + (\boldsymbol{X}^T\boldsymbol{WX})^{-1}\boldsymbol{X}^T\left[ \boldsymbol{y}-\boldsymbol{p}(\boldsymbol{x}) \right], \\
    &amp; = (\boldsymbol{X}^T\boldsymbol{WX})^{-1}\boldsymbol{X}^T\boldsymbol{W} \left(\boldsymbol{X}\boldsymbol{\beta}^{old}+\boldsymbol{W}^{-1} \left[ \boldsymbol{y} - \boldsymbol{p}(\boldsymbol{x})\right] \right), \\
    &amp; = (\boldsymbol{X}^T\boldsymbol{WX})^{-1}\boldsymbol{X}^T\boldsymbol{Wz}.
\tag{31}
\end{align}\]</span></p>
<p>Here, <span class="math inline">\(\boldsymbol{z}=\boldsymbol{X}\boldsymbol{\beta}^{old} + \boldsymbol{W}^{-1}(\boldsymbol{y} - \boldsymbol{p}(\boldsymbol{x}))\)</span>.</p>
<p>Putting all these together, a complete flow of the algorithm is shown below</p>
<p><!-- begin{enumerate} --></p>
<ul>
<li><p> Initialize <span class="math inline">\(\boldsymbol{\beta}.\)</span><label for="tufte-sn-59" class="margin-toggle sidenote-number">59</label><input type="checkbox" id="tufte-sn-59" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">59</span> I.e., use random values for <span class="math inline">\(\boldsymbol{\beta}\)</span>.</span></p></li>
<li><p> Compute <span class="math inline">\(\boldsymbol{p}(\boldsymbol{x}_n)\)</span> by its definition: <span class="math inline">\(\boldsymbol{p}(\boldsymbol{x}_n )=\frac{1}{1+e^{-(\beta_0+\sum_{i=1}^p\, \beta_i x_{ni})}}\)</span> for <span class="math inline">\(n=1,2,\ldots,N\)</span>.</p></li>
<li><p> Compute the diagonal matrix <span class="math inline">\(\boldsymbol{W}\)</span>, with the <span class="math inline">\(n^{th}\)</span> diagonal element as <span class="math inline">\(\boldsymbol{p}\left(\boldsymbol{x}_{n}\right)\left[1-\boldsymbol{p}\left(\boldsymbol{x}_{n}\right)\right]\)</span> for <span class="math inline">\(n=1,2,…,N\)</span>.</p></li>
<li><p> Set <span class="math inline">\(\boldsymbol{z}\)</span> as <span class="math inline">\(= \boldsymbol{X} \boldsymbol{\beta}+\boldsymbol{W}^{-1}[\boldsymbol{y}-\boldsymbol{p}(\boldsymbol{x})]\)</span>.</p></li>
<li><p> Set <span class="math inline">\(\boldsymbol{\beta} = \left(\boldsymbol{X}^{T} \boldsymbol{W X}\right)^{-1} \boldsymbol{X}^{T} \boldsymbol{W} \boldsymbol{z}\)</span>.</p></li>
<li><p> If the stopping criteria<label for="tufte-sn-60" class="margin-toggle sidenote-number">60</label><input type="checkbox" id="tufte-sn-60" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">60</span> A common stopping criteria is to evaluate the difference between two consecutive solutions, i.e., if the Euclidean distance between the two vectors, <span class="math inline">\(\boldsymbol{\beta}^{new}\)</span> and <span class="math inline">\(\boldsymbol{\beta}^{old}\)</span>, is less than <span class="math inline">\(10^{-4}\)</span>, then it is considered no difference and the algorithm stops.</span> is met, stop; otherwise, go back to step 2.</p></li>
</ul>
<p><!-- end{enumerate} --></p>
<p><em>Generalized least squares estimator.</em> The estimation formula as shown in Eq. <a href="logistic-regression-model.html#eq:3-betaupdate">(31)</a> resembles the generalized least squares (GLS) estimator of a regression model, where each data point <span class="math inline">\((\boldsymbol{x}_n,y_n)\)</span> is associated with a weight <span class="math inline">\(w_n\)</span>. This insight revealed by the Newton-Raphson algorithm suggests a new perspective to look at the logistic regression model. The updating formula shown in Eq. <a href="logistic-regression-model.html#eq:3-betaupdate">(31)</a> suggests that, in each iteration of parameter updating, we actually solve a weighted regression model as</p>
<p><span class="math display">\[\boldsymbol{\beta}^{new} \leftarrow \mathop{\arg\min}_{\boldsymbol{\beta}} (\boldsymbol{z}-\boldsymbol{X}\boldsymbol \beta)^T\boldsymbol{W}(\boldsymbol{z}-\boldsymbol{X}\boldsymbol{\beta}).\]</span></p>
<p>For this reason, the algorithm we just introduced is also called the <strong>Iteratively Reweighted Least Squares</strong> (<strong>IRLS</strong>) algorithm. <span class="math inline">\(\boldsymbol{z}\)</span> is referred to as the <strong>adjusted response</strong>.</p>
</div>
<div id="r-lab-2" class="section level3 unnumbered">
<h3>R Lab</h3>
<p>In the AD dataset, the variable <code>DX_bl</code> encodes the diagnosis information, i.e.,<code>0</code> denotes <em>normal</em> while <code>1</code> denotes <em>diseased</em>. We build a logistic regression model using <code>DX_bl</code> as the outcome variable.</p>
<!-- % ^[Using numbers to encode categorical variables is not the best way, but it is not uncommon. You may consider encoding them in a safer way, i.e., convert "1" to be "c1" and "0" to be "c0". Is this an act of paranoid? No. There could be millions of small problems like this, and if you don't seal these little devils in bottles when you build up your analytics pipeline --- you will witness their enormous power. \\ Whatever can go wrong, will go wrong --- Murphy's law.] -->
<p><em>The 7-Step R Pipeline.</em>
<strong>Step 1</strong> is to import data into R.</p>
<p></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="logistic-regression-model.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1 -&gt; Read data into R workstation</span></span>
<span id="cb31-2"><a href="logistic-regression-model.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RCurl is the R package to read csv file using a link</span></span>
<span id="cb31-3"><a href="logistic-regression-model.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RCurl)</span>
<span id="cb31-4"><a href="logistic-regression-model.html#cb31-4" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;https://raw.githubusercontent.com&quot;</span>,</span>
<span id="cb31-5"><a href="logistic-regression-model.html#cb31-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;/analyticsbook/book/main/data/AD.csv&quot;</span>)</span>
<span id="cb31-6"><a href="logistic-regression-model.html#cb31-6" aria-hidden="true" tabindex="-1"></a>AD <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">text=</span><span class="fu">getURL</span>(url))</span>
<span id="cb31-7"><a href="logistic-regression-model.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># str(AD)</span></span></code></pre></div>
<p></p>
<p><strong>Step 2</strong> is for data preprocessing.</p>
<p></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="logistic-regression-model.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2 -&gt; Data preprocessing</span></span>
<span id="cb32-2"><a href="logistic-regression-model.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create your X matrix (predictors) and Y vector (outcome variable)</span></span>
<span id="cb32-3"><a href="logistic-regression-model.html#cb32-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> AD[,<span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>]</span>
<span id="cb32-4"><a href="logistic-regression-model.html#cb32-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> AD<span class="sc">$</span>DX_bl</span>
<span id="cb32-5"><a href="logistic-regression-model.html#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="logistic-regression-model.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The following code makes sure the variable &quot;DX_bl&quot; is a &quot;factor&quot;. </span></span>
<span id="cb32-7"><a href="logistic-regression-model.html#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># It denotes &quot;0&quot; as &quot;c0&quot; and &quot;1&quot; as &quot;c1&quot;, to highlight the fact </span></span>
<span id="cb32-8"><a href="logistic-regression-model.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># that &quot;DX_bl&quot; is a factor variable, not a numerical variable.</span></span>
<span id="cb32-9"><a href="logistic-regression-model.html#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="logistic-regression-model.html#cb32-10" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;c&quot;</span>, Y)</span>
<span id="cb32-11"><a href="logistic-regression-model.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># as.factor is to convert any variable into the </span></span>
<span id="cb32-12"><a href="logistic-regression-model.html#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># format as &quot;factor&quot; variable.</span></span>
<span id="cb32-13"><a href="logistic-regression-model.html#cb32-13" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Y) </span>
<span id="cb32-14"><a href="logistic-regression-model.html#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="logistic-regression-model.html#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we integrate everything into a data frame</span></span>
<span id="cb32-16"><a href="logistic-regression-model.html#cb32-16" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X,Y)</span>
<span id="cb32-17"><a href="logistic-regression-model.html#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data)[<span class="dv">16</span>] <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;DX_bl&quot;</span>)</span>
<span id="cb32-18"><a href="logistic-regression-model.html#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="logistic-regression-model.html#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># generate the same random sequence</span></span>
<span id="cb32-20"><a href="logistic-regression-model.html#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a training data (half the original data size)</span></span>
<span id="cb32-21"><a href="logistic-regression-model.html#cb32-21" aria-hidden="true" tabindex="-1"></a>train.ix <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(data),<span class="fu">floor</span>( <span class="fu">nrow</span>(data)<span class="sc">/</span><span class="dv">2</span>) )</span>
<span id="cb32-22"><a href="logistic-regression-model.html#cb32-22" aria-hidden="true" tabindex="-1"></a>data.train <span class="ot">&lt;-</span> data[train.ix,]</span>
<span id="cb32-23"><a href="logistic-regression-model.html#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a testing data (half the original data size)</span></span>
<span id="cb32-24"><a href="logistic-regression-model.html#cb32-24" aria-hidden="true" tabindex="-1"></a>data.test <span class="ot">&lt;-</span> data[<span class="sc">-</span>train.ix,]</span></code></pre></div>
<p></p>
<p><strong>Step 3</strong> is to use the function <code>glm()</code> to build a logistic regression model<label for="tufte-sn-61" class="margin-toggle sidenote-number">61</label><input type="checkbox" id="tufte-sn-61" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">61</span> Type<code>help(glm)</code> in R Console to learn more of the function.</span>.</p>
<p></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="logistic-regression-model.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3 -&gt; Use glm() function to build a full model </span></span>
<span id="cb33-2"><a href="logistic-regression-model.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with all predictors</span></span>
<span id="cb33-3"><a href="logistic-regression-model.html#cb33-3" aria-hidden="true" tabindex="-1"></a>logit.AD.full <span class="ot">&lt;-</span> <span class="fu">glm</span>(DX_bl<span class="sc">~</span>., <span class="at">data =</span> data.train,</span>
<span id="cb33-4"><a href="logistic-regression-model.html#cb33-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb33-5"><a href="logistic-regression-model.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.AD.full)</span></code></pre></div>
<p></p>
<p>And the result is shown below</p>
<p></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="logistic-regression-model.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb34-2"><a href="logistic-regression-model.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">## glm(formula = DX_bl ~ ., family = &quot;binomial&quot;, data = data.train)</span></span>
<span id="cb34-3"><a href="logistic-regression-model.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-4"><a href="logistic-regression-model.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals: </span></span>
<span id="cb34-5"><a href="logistic-regression-model.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min       1Q   Median       3Q      Max  </span></span>
<span id="cb34-6"><a href="logistic-regression-model.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="do">## -2.4250  -0.3645  -0.0704   0.2074   3.1707  </span></span>
<span id="cb34-7"><a href="logistic-regression-model.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-8"><a href="logistic-regression-model.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb34-9"><a href="logistic-regression-model.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="do">##              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb34-10"><a href="logistic-regression-model.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  43.97098    7.83797   5.610 2.02e-08 ***</span></span>
<span id="cb34-11"><a href="logistic-regression-model.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="do">## AGE          -0.07304    0.03875  -1.885  0.05945 .  </span></span>
<span id="cb34-12"><a href="logistic-regression-model.html#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="do">## PTGENDER      0.48668    0.46682   1.043  0.29716    </span></span>
<span id="cb34-13"><a href="logistic-regression-model.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="do">## PTEDUCAT     -0.24907    0.08714  -2.858  0.00426 ** </span></span>
<span id="cb34-14"><a href="logistic-regression-model.html#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="do">## FDG          -3.28887    0.59927  -5.488 4.06e-08 ***</span></span>
<span id="cb34-15"><a href="logistic-regression-model.html#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="do">## AV45          2.09311    1.36020   1.539  0.12385    </span></span>
<span id="cb34-16"><a href="logistic-regression-model.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="do">## HippoNV     -38.03422    6.16738  -6.167 6.96e-10 ***</span></span>
<span id="cb34-17"><a href="logistic-regression-model.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="do">## e2_1          0.90115    0.85564   1.053  0.29225    </span></span>
<span id="cb34-18"><a href="logistic-regression-model.html#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="do">## e4_1          0.56917    0.54502   1.044  0.29634    </span></span>
<span id="cb34-19"><a href="logistic-regression-model.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="do">## rs3818361    -0.47249    0.45309  -1.043  0.29703    </span></span>
<span id="cb34-20"><a href="logistic-regression-model.html#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="do">## rs744373      0.02681    0.44235   0.061  0.95166    </span></span>
<span id="cb34-21"><a href="logistic-regression-model.html#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="do">## rs11136000   -0.31382    0.46274  -0.678  0.49766    </span></span>
<span id="cb34-22"><a href="logistic-regression-model.html#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="do">## rs610932      0.55388    0.49832   1.112  0.26635    </span></span>
<span id="cb34-23"><a href="logistic-regression-model.html#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="do">## rs3851179    -0.18635    0.44872  -0.415  0.67793    </span></span>
<span id="cb34-24"><a href="logistic-regression-model.html#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="do">## rs3764650    -0.48152    0.54982  -0.876  0.38115    </span></span>
<span id="cb34-25"><a href="logistic-regression-model.html#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="do">## rs3865444     0.74252    0.45761   1.623  0.10467    </span></span>
<span id="cb34-26"><a href="logistic-regression-model.html#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb34-27"><a href="logistic-regression-model.html#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></span>
<span id="cb34-28"><a href="logistic-regression-model.html#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-29"><a href="logistic-regression-model.html#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb34-30"><a href="logistic-regression-model.html#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-31"><a href="logistic-regression-model.html#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 349.42  on 257  degrees of freedom</span></span>
<span id="cb34-32"><a href="logistic-regression-model.html#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 139.58  on 242  degrees of freedom</span></span>
<span id="cb34-33"><a href="logistic-regression-model.html#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 171.58</span></span>
<span id="cb34-34"><a href="logistic-regression-model.html#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb34-35"><a href="logistic-regression-model.html#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 7</span></span></code></pre></div>
<p></p>
<p><strong>Step 4</strong> is to use the <code>step()</code> function for model selection.</p>
<!-- % ^[1) direction="backward" was used in the example of linear regression model; here, we use  direction="both", which means that we start with the full model, then sequentially both remove insignificant variables and also recruit new variables (from the ones that have been removed previously - why? remember that the fact that a variable is significant also depends on what are other variables on the model already); 2) trace = 0 is to disable the presentation of showing all the models that have been evaluated along the process. If you want to see the process, simply set trace = 1 or not specify this argument (by default, trace = 1 in the \textcolor[rgb]{0,0,1}{step}() function).] -->
<p></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="logistic-regression-model.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4 -&gt; use step() to automatically delete </span></span>
<span id="cb35-2"><a href="logistic-regression-model.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># all the insignificant</span></span>
<span id="cb35-3"><a href="logistic-regression-model.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb35-4"><a href="logistic-regression-model.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Also means, automatic model selection</span></span>
<span id="cb35-5"><a href="logistic-regression-model.html#cb35-5" aria-hidden="true" tabindex="-1"></a>logit.AD.reduced <span class="ot">&lt;-</span> <span class="fu">step</span>(logit.AD.full, <span class="at">direction=</span><span class="st">&quot;both&quot;</span>,</span>
<span id="cb35-6"><a href="logistic-regression-model.html#cb35-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">trace =</span> <span class="dv">0</span>)</span>
<span id="cb35-7"><a href="logistic-regression-model.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.AD.reduced)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="logistic-regression-model.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb36-2"><a href="logistic-regression-model.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="do">## glm(formula = DX_bl ~ AGE + PTEDUCAT + FDG + AV45 + HippoNV + </span></span>
<span id="cb36-3"><a href="logistic-regression-model.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="do">##     rs3865444, family = &quot;binomial&quot;, data = data.train)</span></span>
<span id="cb36-4"><a href="logistic-regression-model.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb36-5"><a href="logistic-regression-model.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals: </span></span>
<span id="cb36-6"><a href="logistic-regression-model.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="do">##      Min        1Q    Median        3Q       Max  </span></span>
<span id="cb36-7"><a href="logistic-regression-model.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="do">## -2.38957  -0.42407  -0.09268   0.25092   2.73658  </span></span>
<span id="cb36-8"><a href="logistic-regression-model.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb36-9"><a href="logistic-regression-model.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb36-10"><a href="logistic-regression-model.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="do">##              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb36-11"><a href="logistic-regression-model.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  42.68795    7.07058   6.037 1.57e-09 ***</span></span>
<span id="cb36-12"><a href="logistic-regression-model.html#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="do">## AGE          -0.07993    0.03650  -2.190  0.02853 *  </span></span>
<span id="cb36-13"><a href="logistic-regression-model.html#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="do">## PTEDUCAT     -0.22195    0.08242  -2.693  0.00708 ** </span></span>
<span id="cb36-14"><a href="logistic-regression-model.html#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="do">## FDG          -3.16994    0.55129  -5.750 8.92e-09 ***</span></span>
<span id="cb36-15"><a href="logistic-regression-model.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="do">## AV45          2.62670    1.18420   2.218  0.02655 *  </span></span>
<span id="cb36-16"><a href="logistic-regression-model.html#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="do">## HippoNV     -36.22215    5.53083  -6.549 5.79e-11 ***</span></span>
<span id="cb36-17"><a href="logistic-regression-model.html#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="do">## rs3865444     0.71373    0.44290   1.612  0.10707    </span></span>
<span id="cb36-18"><a href="logistic-regression-model.html#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb36-19"><a href="logistic-regression-model.html#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></span>
<span id="cb36-20"><a href="logistic-regression-model.html#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb36-21"><a href="logistic-regression-model.html#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb36-22"><a href="logistic-regression-model.html#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb36-23"><a href="logistic-regression-model.html#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 349.42  on 257  degrees of freedom</span></span>
<span id="cb36-24"><a href="logistic-regression-model.html#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 144.62  on 251  degrees of freedom</span></span>
<span id="cb36-25"><a href="logistic-regression-model.html#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 158.62</span></span>
<span id="cb36-26"><a href="logistic-regression-model.html#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb36-27"><a href="logistic-regression-model.html#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 7</span></span></code></pre></div>
<p></p>
<p>You may have noticed that some variables included in this model are actually not significant.</p>
<p><strong>Step 4</strong> compares the final model selected by the <code>step()</code> function with the full model.</p>
<p></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="logistic-regression-model.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4 continued</span></span>
<span id="cb37-2"><a href="logistic-regression-model.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(logit.AD.reduced,logit.AD.full,<span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span>
<span id="cb37-3"><a href="logistic-regression-model.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The argument, test = &quot;LRT&quot;, means that the p-value </span></span>
<span id="cb37-4"><a href="logistic-regression-model.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># is derived via the Likelihood Ratio Test (LRT).</span></span></code></pre></div>
<p></p>
<p>And we can see that the two models are not statistically different, i.e., <em>p-value</em> is <span class="math inline">\(0.8305\)</span>.</p>
<p><strong>Step 5</strong> is to evaluate the overall significance of the final model<label for="tufte-sn-62" class="margin-toggle sidenote-number">62</label><input type="checkbox" id="tufte-sn-62" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">62</span> <strong>Step 4</strong> compares two models. <strong>Step 5</strong> tests if a model has a lack-of-fit with data. A model could be better than another, but it is possible that both of them fit the data poorly.</span>.</p>
<p></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="logistic-regression-model.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5 -&gt; test the significance of the logistic model</span></span>
<span id="cb38-2"><a href="logistic-regression-model.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test residual deviance for lack-of-fit </span></span>
<span id="cb38-3"><a href="logistic-regression-model.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (if &gt; 0.10, little-to-no lack-of-fit)</span></span>
<span id="cb38-4"><a href="logistic-regression-model.html#cb38-4" aria-hidden="true" tabindex="-1"></a>dev.p.val <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(logit.AD.reduced<span class="sc">$</span>deviance,</span>
<span id="cb38-5"><a href="logistic-regression-model.html#cb38-5" aria-hidden="true" tabindex="-1"></a>                        logit.AD.reduced<span class="sc">$</span>df.residual)</span></code></pre></div>
<p></p>
<p>And it can be seen that the model shows no lack-of-fit as the <em>p-value</em> is <span class="math inline">\(1\)</span>.</p>
<p></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="logistic-regression-model.html#cb39-1" aria-hidden="true" tabindex="-1"></a>dev.p.val</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="logistic-regression-model.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span></code></pre></div>
<p></p>
<p><strong>Step 6</strong> is to use your final model for prediction. We can do so using the <code>predict()</code> function.</p>
<!-- % ^[A few comments: 1) \textcolor[rgb]{0,0,1}{predict}() is a function that you can find in many R packages. R package developers usually write such a function, in the form as predict(obj, data), where "obj" is the object of the created model by that package, and "data" is the data points you want to predict on. 2) While in many cases this is not needed, sometimes you do need to specify the argument "type". Here, you can type \textcolor[rgb]{0,0,1}{help(predict)} in R Console and see it has several options, e.g., type = c("link", "response", "terms"). We use the default here, i.e., type = "link", which means that we expect the outcome "y\_hat" are the values from the linear equation part of the logistic regression model. In this way, "y\_hat" are the intermediate values that are not the final prediction. To convert it into final prediction, which should be binary, we can use "0" as the cut-off value, i.e., if y\_hat < 0, we name it as one class, and if y\_hat > 0, it is another class. Notice that the cut-off value as 0 is default, but not necessary an optimal value in every application.] -->
<p></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="logistic-regression-model.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6 -&gt; Predict on test data using your </span></span>
<span id="cb41-2"><a href="logistic-regression-model.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic regression model</span></span>
<span id="cb41-3"><a href="logistic-regression-model.html#cb41-3" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit.AD.reduced, data.test)</span></code></pre></div>
<p></p>
<p><strong>Step 7</strong> is to evaluate the prediction performance of the final model.</p>
<p></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="logistic-regression-model.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 7 -&gt; Evaluate the prediction performance of </span></span>
<span id="cb42-2"><a href="logistic-regression-model.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># your logistic regression model</span></span>
<span id="cb42-3"><a href="logistic-regression-model.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) Three main metrics for classification: Accuracy, </span></span>
<span id="cb42-4"><a href="logistic-regression-model.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensitivity (1- False Positive), </span></span>
<span id="cb42-5"><a href="logistic-regression-model.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Specificity (1 - False Negative)</span></span>
<span id="cb42-6"><a href="logistic-regression-model.html#cb42-6" aria-hidden="true" tabindex="-1"></a>y_hat2 <span class="ot">&lt;-</span> y_hat</span>
<span id="cb42-7"><a href="logistic-regression-model.html#cb42-7" aria-hidden="true" tabindex="-1"></a>y_hat2[<span class="fu">which</span>(y_hat <span class="sc">&gt;</span> <span class="dv">0</span>)] <span class="ot">=</span> <span class="st">&quot;c1&quot;</span> </span>
<span id="cb42-8"><a href="logistic-regression-model.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Since y_hat here is the values from the linear equation </span></span>
<span id="cb42-9"><a href="logistic-regression-model.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># part of the logistic regression model, by default, </span></span>
<span id="cb42-10"><a href="logistic-regression-model.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># we should use 0 as a cut-off value (only by default, </span></span>
<span id="cb42-11"><a href="logistic-regression-model.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># not optimal though), i.e., if y_hat &lt; 0, we name it </span></span>
<span id="cb42-12"><a href="logistic-regression-model.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># as one class, and if y_hat &gt; 0, it is another class.</span></span>
<span id="cb42-13"><a href="logistic-regression-model.html#cb42-13" aria-hidden="true" tabindex="-1"></a>y_hat2[<span class="fu">which</span>(y_hat <span class="sc">&lt;</span> <span class="dv">0</span>)] <span class="ot">=</span> <span class="st">&quot;c0&quot;</span></span>
<span id="cb42-14"><a href="logistic-regression-model.html#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="logistic-regression-model.html#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) </span>
<span id="cb42-16"><a href="logistic-regression-model.html#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co"># confusionMatrix() in the package &quot;caret&quot; is a powerful </span></span>
<span id="cb42-17"><a href="logistic-regression-model.html#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co"># function to summarize the prediction performance of a </span></span>
<span id="cb42-18"><a href="logistic-regression-model.html#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co"># classification model, reporting metrics such as Accuracy, </span></span>
<span id="cb42-19"><a href="logistic-regression-model.html#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensitivity (1- False Positive), </span></span>
<span id="cb42-20"><a href="logistic-regression-model.html#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Specificity (1 - False Negative), to name a few.</span></span>
<span id="cb42-21"><a href="logistic-regression-model.html#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb42-22"><a href="logistic-regression-model.html#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">table</span>(y_hat2, data.test<span class="sc">$</span>DX_bl))</span>
<span id="cb42-23"><a href="logistic-regression-model.html#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="logistic-regression-model.html#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) ROC curve is another commonly reported metric for </span></span>
<span id="cb42-25"><a href="logistic-regression-model.html#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co"># classification models</span></span>
<span id="cb42-26"><a href="logistic-regression-model.html#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC) </span>
<span id="cb42-27"><a href="logistic-regression-model.html#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co"># pROC has the roc() function that is very useful here</span></span>
<span id="cb42-28"><a href="logistic-regression-model.html#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(data.test<span class="sc">$</span>DX_bl, y_hat),</span>
<span id="cb42-29"><a href="logistic-regression-model.html#cb42-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">main=</span><span class="st">&quot;ROC Curve&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-Step7-ROC"></span>
<img src="graphics/3_Step7_ROC.png" alt="The ROC curve of the final model" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 30: The ROC curve of the final model<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>Results are shown below. We haven’t discussed the <strong>ROC curve</strong> yet, which will be a main topic in <strong>Chapter 5</strong>. At this moment, remember that a model with a ROC curve that has a larger <strong>Area Under the Curve</strong> (<strong>AUC</strong>) is a better model. And a model whose ROC curve ties with the diagonal straight line (as shown in Figure <a href="logistic-regression-model.html#fig:f3-Step7-ROC">30</a>) is equivalent with random guess.</p>
<p></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="logistic-regression-model.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## y_hat2  c0  c1</span></span>
<span id="cb43-2"><a href="logistic-regression-model.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="do">##     c0 117  29</span></span>
<span id="cb43-3"><a href="logistic-regression-model.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="do">##     c1  16  97</span></span>
<span id="cb43-4"><a href="logistic-regression-model.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb43-5"><a href="logistic-regression-model.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="do">##                Accuracy : 0.8263          </span></span>
<span id="cb43-6"><a href="logistic-regression-model.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                  95% CI : (0.7745, 0.8704)</span></span>
<span id="cb43-7"><a href="logistic-regression-model.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="do">##     No Information Rate : 0.5135          </span></span>
<span id="cb43-8"><a href="logistic-regression-model.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     P-Value [Acc &gt; NIR] : &lt; 2e-16         </span></span>
<span id="cb43-9"><a href="logistic-regression-model.html#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb43-10"><a href="logistic-regression-model.html#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                   Kappa : 0.6513          </span></span>
<span id="cb43-11"><a href="logistic-regression-model.html#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb43-12"><a href="logistic-regression-model.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  Mcnemar&#39;s Test P-Value : 0.07364         </span></span>
<span id="cb43-13"><a href="logistic-regression-model.html#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb43-14"><a href="logistic-regression-model.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="do">##             Sensitivity : 0.8797          </span></span>
<span id="cb43-15"><a href="logistic-regression-model.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="do">##             Specificity : 0.7698          </span></span>
<span id="cb43-16"><a href="logistic-regression-model.html#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="do">##          Pos Pred Value : 0.8014          </span></span>
<span id="cb43-17"><a href="logistic-regression-model.html#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="do">##          Neg Pred Value : 0.8584          </span></span>
<span id="cb43-18"><a href="logistic-regression-model.html#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="do">##              Prevalence : 0.5135          </span></span>
<span id="cb43-19"><a href="logistic-regression-model.html#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="do">##          Detection Rate : 0.4517          </span></span>
<span id="cb43-20"><a href="logistic-regression-model.html#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="do">##    Detection Prevalence : 0.5637          </span></span>
<span id="cb43-21"><a href="logistic-regression-model.html#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="do">##       Balanced Accuracy : 0.8248          </span></span>
<span id="cb43-22"><a href="logistic-regression-model.html#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           </span></span>
<span id="cb43-23"><a href="logistic-regression-model.html#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="do">##        &#39;Positive&#39; Class : c0 </span></span></code></pre></div>
<p></p>
<p><em>Model uncertainty.</em> The <span class="math inline">\(95 \%\)</span> confidence interval (CI) of the regression coefficients can be derived, as shown below</p>
<p></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="logistic-regression-model.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="do">## coefficients and 95% CI</span></span>
<span id="cb44-2"><a href="logistic-regression-model.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">coef =</span> <span class="fu">coef</span>(logit.AD.reduced), <span class="fu">confint</span>(logit.AD.reduced))</span></code></pre></div>
<p></p>
<p>Results are</p>
<p></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="logistic-regression-model.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                     coef       2.5 %       97.5 %</span></span>
<span id="cb45-2"><a href="logistic-regression-model.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  42.68794758  29.9745022  57.88659748</span></span>
<span id="cb45-3"><a href="logistic-regression-model.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="do">## AGE          -0.07993473  -0.1547680  -0.01059348</span></span>
<span id="cb45-4"><a href="logistic-regression-model.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="do">## PTEDUCAT     -0.22195425  -0.3905105  -0.06537066</span></span>
<span id="cb45-5"><a href="logistic-regression-model.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="do">## FDG          -3.16994212  -4.3519800  -2.17636447</span></span>
<span id="cb45-6"><a href="logistic-regression-model.html#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="do">## AV45          2.62670085   0.3736259   5.04703489</span></span>
<span id="cb45-7"><a href="logistic-regression-model.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="do">## HippoNV     -36.22214822 -48.1671093 -26.35100122</span></span>
<span id="cb45-8"><a href="logistic-regression-model.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="do">## rs3865444     0.71373441  -0.1348687   1.61273264</span></span></code></pre></div>
<p></p>
<p><em>Prediction uncertainty.</em> As in linear regression, we could derive the variance of the estimated regression coefficients <span class="math inline">\(\operatorname{var}(\hat{\boldsymbol{\beta}})\)</span>; then, since <span class="math inline">\(\boldsymbol{\hat{y}} = \boldsymbol{X} \hat{\boldsymbol{\beta}}\)</span>, we can derive <span class="math inline">\(\operatorname{var}(\boldsymbol{\hat{y}})\)</span><label for="tufte-sn-63" class="margin-toggle sidenote-number">63</label><input type="checkbox" id="tufte-sn-63" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">63</span> The linearity assumption between <span class="math inline">\(\boldsymbol{x}\)</span> and <span class="math inline">\(y\)</span> enables the explicit characterization of this chain of uncertainty propagation.</span>. Skipping the technical details, the <span class="math inline">\(95\%\)</span> CI of the predictions are obtained using the R code below</p>
<p></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="logistic-regression-model.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remark: how to obtain the 95% CI of the predictions</span></span>
<span id="cb46-2"><a href="logistic-regression-model.html#cb46-2" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit.AD.reduced, data.test, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, </span>
<span id="cb46-3"><a href="logistic-regression-model.html#cb46-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">se.fit =</span> <span class="cn">TRUE</span>) </span>
<span id="cb46-4"><a href="logistic-regression-model.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># se.fit = TRUE, is to get the standard error in the predictions, </span></span>
<span id="cb46-5"><a href="logistic-regression-model.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># which is necessary information for us to construct </span></span>
<span id="cb46-6"><a href="logistic-regression-model.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the 95% CI of the predictions</span></span>
<span id="cb46-7"><a href="logistic-regression-model.html#cb46-7" aria-hidden="true" tabindex="-1"></a>data.test<span class="sc">$</span>fit    <span class="ot">&lt;-</span> y_hat<span class="sc">$</span>fit</span>
<span id="cb46-8"><a href="logistic-regression-model.html#cb46-8" aria-hidden="true" tabindex="-1"></a>data.test<span class="sc">$</span>se.fit <span class="ot">&lt;-</span> y_hat<span class="sc">$</span>se.fit</span>
<span id="cb46-9"><a href="logistic-regression-model.html#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We can readily convert this information into the 95% CIs </span></span>
<span id="cb46-10"><a href="logistic-regression-model.html#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># of the predictions (the way these 95% CIs are </span></span>
<span id="cb46-11"><a href="logistic-regression-model.html#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># derived are again, only in approximated sense).</span></span>
<span id="cb46-12"><a href="logistic-regression-model.html#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># CI for fitted values</span></span>
<span id="cb46-13"><a href="logistic-regression-model.html#cb46-13" aria-hidden="true" tabindex="-1"></a>data.test <span class="ot">&lt;-</span> <span class="fu">within</span>(data.test, {</span>
<span id="cb46-14"><a href="logistic-regression-model.html#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># added &quot;fitted&quot; to make predictions at appended temp values</span></span>
<span id="cb46-15"><a href="logistic-regression-model.html#cb46-15" aria-hidden="true" tabindex="-1"></a>fitted    <span class="ot">=</span> <span class="fu">exp</span>(fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(fit))</span>
<span id="cb46-16"><a href="logistic-regression-model.html#cb46-16" aria-hidden="true" tabindex="-1"></a>fit.lower <span class="ot">=</span> <span class="fu">exp</span>(fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> </span>
<span id="cb46-17"><a href="logistic-regression-model.html#cb46-17" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">exp</span>(fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit))</span>
<span id="cb46-18"><a href="logistic-regression-model.html#cb46-18" aria-hidden="true" tabindex="-1"></a>fit.upper <span class="ot">=</span> <span class="fu">exp</span>(fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> </span>
<span id="cb46-19"><a href="logistic-regression-model.html#cb46-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">exp</span>(fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit))</span>
<span id="cb46-20"><a href="logistic-regression-model.html#cb46-20" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<p><em>Odds ratio.</em> The <strong>odds ratio</strong> (<strong>OR</strong>) quantifies the strength of the association between two events, <em>A</em> and <em>B</em>. It is defined as the ratio of the odds of <em>A</em> in the presence of <em>B</em> and the odds of <em>A</em> in the absence of <em>B</em>, or equivalently due to symmetry.</p>
<p><!-- begin{itemize} --></p>
<ul>
<li><p> If the <em>OR</em> equals <span class="math inline">\(1\)</span>, <em>A</em> and <em>B</em> are independent;</p></li>
<li><p> If the <em>OR</em> is greater than <span class="math inline">\(1\)</span>, the presence of one event increases the odds of the other event;</p></li>
<li><p> If the <em>OR</em> is less than <span class="math inline">\(1\)</span>, the presence of one event reduces the odds of the other event.</p></li>
</ul>
<p><!-- end{itemize} --></p>
<p>A regression coefficient of a logistic regression model can be converted into an <em>odds ratio</em>, as done in the following codes.</p>
<p></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="logistic-regression-model.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## odds ratios and 95% CI</span></span>
<span id="cb47-2"><a href="logistic-regression-model.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OR =</span> <span class="fu">coef</span>(logit.AD.reduced), </span>
<span id="cb47-3"><a href="logistic-regression-model.html#cb47-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">confint</span>(logit.AD.reduced)))</span></code></pre></div>
<p></p>
<p>The odds ratios and their <span class="math inline">\(95\%\)</span> CIs are</p>
<p></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="logistic-regression-model.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">##                       OR        2.5 %       97.5 %</span></span>
<span id="cb48-2"><a href="logistic-regression-model.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) 3.460510e+18 1.041744e+13 1.379844e+25</span></span>
<span id="cb48-3"><a href="logistic-regression-model.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="do">## AGE         9.231766e-01 8.566139e-01 9.894624e-01</span></span>
<span id="cb48-4"><a href="logistic-regression-model.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">## PTEDUCAT    8.009520e-01 6.767113e-01 9.367202e-01</span></span>
<span id="cb48-5"><a href="logistic-regression-model.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="do">## FDG         4.200603e-02 1.288128e-02 1.134532e-01</span></span>
<span id="cb48-6"><a href="logistic-regression-model.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="do">## AV45        1.382807e+01 1.452993e+00 1.555605e+02</span></span>
<span id="cb48-7"><a href="logistic-regression-model.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="do">## HippoNV     1.857466e-16 1.205842e-21 3.596711e-12</span></span>
<span id="cb48-8"><a href="logistic-regression-model.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## rs3865444   2.041601e+00 8.738306e-01 5.016501e+00</span></span></code></pre></div>
<p></p>
<p><em>Exploratory Data Analysis (EDA).</em> EDA essentially conceptualizes the analysis process as a dynamic one, sometimes with a playful tone<label for="tufte-sn-64" class="margin-toggle sidenote-number">64</label><input type="checkbox" id="tufte-sn-64" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">64</span> And it is probably because of this conceptual framework, EDA happens to use a lot of figures to explore the data. Figures are rich in information, some are not easily generalized into abstract numbers.</span> EDA could start with something simple. For example, we can start with a smaller model rather than throw everything into the analysis.</p>
<p>Let’s revisit the data analysis done in the <em>7-step R pipeline</em> and examine a simple logistic regression model with only one predictor, <code>FDG</code>.</p>
<p></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="logistic-regression-model.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a logistic regression model with FDG</span></span>
<span id="cb49-2"><a href="logistic-regression-model.html#cb49-2" aria-hidden="true" tabindex="-1"></a>logit.AD.FDG <span class="ot">&lt;-</span> <span class="fu">glm</span>(DX_bl <span class="sc">~</span> FDG, <span class="at">data =</span> AD, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb49-3"><a href="logistic-regression-model.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.AD.FDG)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="logistic-regression-model.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb50-2"><a href="logistic-regression-model.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb50-3"><a href="logistic-regression-model.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="do">## glm(formula = DX_bl   FDG, family = &quot;binomial&quot;, data = AD)</span></span>
<span id="cb50-4"><a href="logistic-regression-model.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb50-5"><a href="logistic-regression-model.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals:</span></span>
<span id="cb50-6"><a href="logistic-regression-model.html#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min       1Q   Median       3Q      Max</span></span>
<span id="cb50-7"><a href="logistic-regression-model.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="do">## -2.4686  -0.8166  -0.2758   0.7679   2.7812</span></span>
<span id="cb50-8"><a href="logistic-regression-model.html#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb50-9"><a href="logistic-regression-model.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb50-10"><a href="logistic-regression-model.html#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="do">##             Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span id="cb50-11"><a href="logistic-regression-model.html#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)  18.3300     1.7676   10.37   &lt;2e-16 ***</span></span>
<span id="cb50-12"><a href="logistic-regression-model.html#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="do">## FDG          -2.9370     0.2798  -10.50   &lt;2e-16 ***</span></span>
<span id="cb50-13"><a href="logistic-regression-model.html#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb50-14"><a href="logistic-regression-model.html#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb50-15"><a href="logistic-regression-model.html#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb50-16"><a href="logistic-regression-model.html#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb50-17"><a href="logistic-regression-model.html#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb50-18"><a href="logistic-regression-model.html#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null deviance: 711.27  on 516  degrees of freedom</span></span>
<span id="cb50-19"><a href="logistic-regression-model.html#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual deviance: 499.00  on 515  degrees of freedom</span></span>
<span id="cb50-20"><a href="logistic-regression-model.html#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 503</span></span>
<span id="cb50-21"><a href="logistic-regression-model.html#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb50-22"><a href="logistic-regression-model.html#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 5</span></span></code></pre></div>
<p></p>
<p>It can be seen that the predictor <code>FDG</code> is significant, as the <em>p-value</em> is <span class="math inline">\(&lt;2e-16\)</span> that is far less than <span class="math inline">\(0.05\)</span>. On the other hand, although there is no <em>R-Squared</em> in the logistic regression model, we could observe that, out of the total deviance of <span class="math inline">\(711.27\)</span>, <span class="math inline">\(711.27 - 499.00 = 212.27\)</span> could be explained by <code>FDG</code>.</p>
<p>This process could be repeated for every variable in order to have a sense of what are their <em>marginal</em> contributions in explaining away the variation in the outcome variable. This practice, which seems dull, is not always associated with an immediate reward. But it is not uncommon in practice, particularly when we have seen in <strong>Chapter 2</strong> that, in regression models, the regression coefficients are interdependent, the regression models are not causal models, and, when you throw variables into the model, they may generate interactions just like chemicals, etc. Looking at your data from every possible angle is useful to conduct data <em>analytics</em>.</p>
<p>Back to the simple model that only uses one variable, <code>FDG</code>. To understand better how well it predicts the outcome, we can draw figures to visualize the predictions. First, let’s get the predictions and their <span class="math inline">\(95\%\)</span> CI values.</p>
<p></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="logistic-regression-model.html#cb51-1" aria-hidden="true" tabindex="-1"></a>logit.AD.FDG <span class="ot">&lt;-</span> <span class="fu">glm</span>(DX_bl <span class="sc">~</span>   FDG, <span class="at">data =</span> data.train,</span>
<span id="cb51-2"><a href="logistic-regression-model.html#cb51-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb51-3"><a href="logistic-regression-model.html#cb51-3" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit.AD.FDG, data.test, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>,</span>
<span id="cb51-4"><a href="logistic-regression-model.html#cb51-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-5"><a href="logistic-regression-model.html#cb51-5" aria-hidden="true" tabindex="-1"></a>data.test<span class="sc">$</span>fit    <span class="ot">&lt;-</span> y_hat<span class="sc">$</span>fit</span>
<span id="cb51-6"><a href="logistic-regression-model.html#cb51-6" aria-hidden="true" tabindex="-1"></a>data.test<span class="sc">$</span>se.fit <span class="ot">&lt;-</span> y_hat<span class="sc">$</span>se.fit</span>
<span id="cb51-7"><a href="logistic-regression-model.html#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="logistic-regression-model.html#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CI for fitted values</span></span>
<span id="cb51-9"><a href="logistic-regression-model.html#cb51-9" aria-hidden="true" tabindex="-1"></a>data.test <span class="ot">&lt;-</span> <span class="fu">within</span>(data.test, {</span>
<span id="cb51-10"><a href="logistic-regression-model.html#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># added &quot;fitted&quot; to make predictions at appended temp values</span></span>
<span id="cb51-11"><a href="logistic-regression-model.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  fitted    <span class="ot">=</span> <span class="fu">exp</span>(fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(fit))</span>
<span id="cb51-12"><a href="logistic-regression-model.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  fit.lower <span class="ot">=</span> <span class="fu">exp</span>(fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span></span>
<span id="cb51-13"><a href="logistic-regression-model.html#cb51-13" aria-hidden="true" tabindex="-1"></a>                                                    se.fit))</span>
<span id="cb51-14"><a href="logistic-regression-model.html#cb51-14" aria-hidden="true" tabindex="-1"></a>  fit.upper <span class="ot">=</span> <span class="fu">exp</span>(fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span></span>
<span id="cb51-15"><a href="logistic-regression-model.html#cb51-15" aria-hidden="true" tabindex="-1"></a>                                                    se.fit))</span>
<span id="cb51-16"><a href="logistic-regression-model.html#cb51-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-pred-FDG-boxplot"></span>
<img src="graphics/3_pred_FDG_boxplot.png" alt="Boxplots of the *predicted probabilities of diseased*, i.e., the $Pr(y=1|\boldsymbol{x})$" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 31: Boxplots of the <em>predicted probabilities of diseased</em>, i.e., the <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span><!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>We then draw Figure <a href="logistic-regression-model.html#fig:f3-pred-FDG-boxplot">31</a> using the following script.</p>
<p></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="logistic-regression-model.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Boxplot to evaluate the prediction performance</span></span>
<span id="cb52-2"><a href="logistic-regression-model.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb52-3"><a href="logistic-regression-model.html#cb52-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">qplot</span>(<span class="fu">factor</span>(data.test<span class="sc">$</span>DX_bl), data.test<span class="sc">$</span>fit, <span class="at">data =</span> data.test,</span>
<span id="cb52-4"><a href="logistic-regression-model.html#cb52-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">geom=</span><span class="fu">c</span>(<span class="st">&quot;boxplot&quot;</span>), <span class="at">fill =</span> <span class="fu">factor</span>(data.test<span class="sc">$</span>DX_bl)) <span class="sc">+</span> </span>
<span id="cb52-5"><a href="logistic-regression-model.html#cb52-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">&quot;Dx_bl&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-6"><a href="logistic-regression-model.html#cb52-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>))</span></code></pre></div>
<p></p>
<p>Figure <a href="logistic-regression-model.html#fig:f3-pred-FDG-boxplot">31</a> indicates that the model can separate the two classes significantly (while not being good enough). It gives us a global presentation of the prediction. We can draw another figure, Figure <a href="logistic-regression-model.html#fig:f3-1">32</a>, to examine more details, i.e., look into the “local” parts of the predictions to see where we can improve.</p>
<p></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="logistic-regression-model.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb53-2"><a href="logistic-regression-model.html#cb53-2" aria-hidden="true" tabindex="-1"></a>newData <span class="ot">&lt;-</span> data.test[<span class="fu">order</span>(data.test<span class="sc">$</span>FDG),]</span>
<span id="cb53-3"><a href="logistic-regression-model.html#cb53-3" aria-hidden="true" tabindex="-1"></a>newData<span class="sc">$</span>DX_bl <span class="ot">=</span> <span class="fu">as.numeric</span>(newData<span class="sc">$</span>DX_bl)</span>
<span id="cb53-4"><a href="logistic-regression-model.html#cb53-4" aria-hidden="true" tabindex="-1"></a>newData<span class="sc">$</span>DX_bl[<span class="fu">which</span>(newData<span class="sc">$</span>DX_bl<span class="sc">==</span><span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb53-5"><a href="logistic-regression-model.html#cb53-5" aria-hidden="true" tabindex="-1"></a>newData<span class="sc">$</span>DX_bl[<span class="fu">which</span>(newData<span class="sc">$</span>DX_bl<span class="sc">==</span><span class="dv">2</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb53-6"><a href="logistic-regression-model.html#cb53-6" aria-hidden="true" tabindex="-1"></a>newData<span class="sc">$</span>DX_bl <span class="ot">=</span> <span class="fu">as.numeric</span>(newData<span class="sc">$</span>DX_bl)</span>
<span id="cb53-7"><a href="logistic-regression-model.html#cb53-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(newData, <span class="fu">aes</span>(<span class="at">x =</span> FDG, <span class="at">y =</span> DX_bl))</span>
<span id="cb53-8"><a href="logistic-regression-model.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted curve and point-wise 95\% CI</span></span>
<span id="cb53-9"><a href="logistic-regression-model.html#cb53-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> FDG, <span class="at">ymin =</span> fit.lower,</span>
<span id="cb53-10"><a href="logistic-regression-model.html#cb53-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> fit.upper), <span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb53-11"><a href="logistic-regression-model.html#cb53-11" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> FDG, <span class="at">y =</span> fitted), <span class="at">colour=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb53-12"><a href="logistic-regression-model.html#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted values</span></span>
<span id="cb53-13"><a href="logistic-regression-model.html#cb53-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> fitted), <span class="at">size=</span><span class="dv">2</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb53-14"><a href="logistic-regression-model.html#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># observed values</span></span>
<span id="cb53-15"><a href="logistic-regression-model.html#cb53-15" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb53-16"><a href="logistic-regression-model.html#cb53-16" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Probability&quot;</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>))</span>
<span id="cb53-17"><a href="logistic-regression-model.html#cb53-17" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span></span>
<span id="cb53-18"><a href="logistic-regression-model.html#cb53-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Observed and predicted probability of disease&quot;</span>)</span>
<span id="cb53-19"><a href="logistic-regression-model.html#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<p></p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-1"></span>
<img src="graphics/3_1.png" alt="Predicted probabilities (the red curve) with their 95\% CIs (the gray area) versus observed outcomes in data (the dots above and below)" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 32: Predicted probabilities (the red curve) with their 95% CIs (the gray area) versus observed outcomes in data (the dots above and below)<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>Figure <a href="logistic-regression-model.html#fig:f3-1">32</a> shows that the model captures the relationship between <code>FDG</code> with <code>DX_bl</code> with a smooth logit curve, and the prediction confidences are fairly small (evidenced by the tight 95% CIs). On the other hand, it is also obvious that the single-predictor model does well on the two ends of the probability range (i.e., close to <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>), but not in the middle range where data points from the two classes could not be clearly separated.</p>
<p>We can add more predictors to enhance its prediction power. To decide on which predictors we should include, we can visualize the relationships between the predictors with the outcome variable. For example, continuous predictors could be presented in <strong>Boxplot</strong> to see if the distribution of the continuous predictor is different across the two classes, i.e., if it is different, it means the predictor could help separate the two classes. The following R codes generate Figure <a href="logistic-regression-model.html#fig:f3-2">33</a>.</p>
<p></p>
<div class="figure"><span id="fig:f3-2"></span>
<p class="caption marginnote shownote">
Figure 33: Boxplots of the continuous predictors in the two classes
</p>
<img src="graphics/3_2.png" alt="Boxplots of the continuous predictors in the two classes" width="100%"  />
</div>
<p></p>
<p></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="logistic-regression-model.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;reshape2&quot;)</span></span>
<span id="cb54-2"><a href="logistic-regression-model.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(reshape2)</span>
<span id="cb54-3"><a href="logistic-regression-model.html#cb54-3" aria-hidden="true" tabindex="-1"></a>data.train<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(data.train)[<span class="dv">1</span>])</span>
<span id="cb54-4"><a href="logistic-regression-model.html#cb54-4" aria-hidden="true" tabindex="-1"></a>AD.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(data.train[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">16</span>,<span class="dv">17</span>)],</span>
<span id="cb54-5"><a href="logistic-regression-model.html#cb54-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;DX_bl&quot;</span>))</span>
<span id="cb54-6"><a href="logistic-regression-model.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data using ggplot</span></span>
<span id="cb54-7"><a href="logistic-regression-model.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb54-8"><a href="logistic-regression-model.html#cb54-8" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(AD.long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(DX_bl), <span class="at">y =</span> value))</span>
<span id="cb54-9"><a href="logistic-regression-model.html#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot, size=.75 to stand out behind CI</span></span>
<span id="cb54-10"><a href="logistic-regression-model.html#cb54-10" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb54-11"><a href="logistic-regression-model.html#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># points for observed data</span></span>
<span id="cb54-12"><a href="logistic-regression-model.html#cb54-12" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">w =</span> <span class="fl">0.05</span>, <span class="at">h =</span> <span class="dv">0</span>),</span>
<span id="cb54-13"><a href="logistic-regression-model.html#cb54-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">alpha =</span> <span class="fl">0.1</span>)</span>
<span id="cb54-14"><a href="logistic-regression-model.html#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co"># diamond at mean for each group</span></span>
<span id="cb54-15"><a href="logistic-regression-model.html#cb54-15" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">shape =</span> <span class="dv">18</span>,</span>
<span id="cb54-16"><a href="logistic-regression-model.html#cb54-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size =</span> <span class="dv">6</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb54-17"><a href="logistic-regression-model.html#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co"># confidence limits based on normal distribution</span></span>
<span id="cb54-18"><a href="logistic-regression-model.html#cb54-18" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> <span class="st">&quot;mean_cl_normal&quot;</span>,</span>
<span id="cb54-19"><a href="logistic-regression-model.html#cb54-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">geom =</span> <span class="st">&quot;errorbar&quot;</span>, <span class="at">width =</span> .<span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb54-20"><a href="logistic-regression-model.html#cb54-20" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb54-21"><a href="logistic-regression-model.html#cb54-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span></span>
<span id="cb54-22"><a href="logistic-regression-model.html#cb54-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Boxplots of variables by diagnosis (0 - normal; 1 - patient)&quot;</span>)</span>
<span id="cb54-23"><a href="logistic-regression-model.html#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<p></p>
<p>Figure <a href="logistic-regression-model.html#fig:f3-2">33</a> shows that some variables, e.g., <code>FDG</code> and <code>HippoNV</code>, could separate the two classes significantly. Some variables, such as <code>AV45</code> and <code>AGE</code>, have less prediction power, but still look promising. Note these observations cautiously, since these figures only show <em>marginal</em> relationship among variables<label for="tufte-sn-65" class="margin-toggle sidenote-number">65</label><input type="checkbox" id="tufte-sn-65" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">65</span> Boxplot is nice but it cannot show synergistic effects among the variables.</span>.</p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f3-3"></span>
<img src="graphics/3_3.png" alt="Boxplots of the *predicted probabilities of diseased*, i.e., the $Pr(y=1|\boldsymbol{x})$" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 34: Boxplots of the <em>predicted probabilities of diseased</em>, i.e., the <span class="math inline">\(Pr(y=1|\boldsymbol{x})\)</span><!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>Figure <a href="logistic-regression-model.html#fig:f3-3">34</a> shows the boxplot of the predicted probabilities of diseased made by the final model identified in <strong>Step 4</strong> of the <em>7-step R pipeline</em>. This figure is to be compared with Figure <a href="logistic-regression-model.html#fig:f3-pred-FDG-boxplot">31</a>. It indicates that the final model is much better than the model that only uses the predictor <code>FDG</code> alone.</p>
</div>
</div>
<p style="text-align: center;">
<a href="overview-1.html"><button class="btn btn-default">Previous</button></a>
<a href="ranking-problem-by-pairwise-comparison.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>

<script src="js/jquery.js"></script>
<script src="js/tablesaw-stackonly.js"></script>
<script src="js/nudge.min.js"></script>


<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
