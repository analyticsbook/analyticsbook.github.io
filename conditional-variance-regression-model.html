<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Conditional variance regression model | Data Analytics" />
<meta property="og:type" content="book" />





<meta name="author" content="Shuai Huang &amp; Houtao Deng" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Conditional variance regression model | Data Analytics">

<title>Conditional variance regression model | Data Analytics</title>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<script src="https://use.typekit.net/ajy6rnl.js"></script>
<script>try{Typekit.load({ async: true });}catch(e){}</script>
<!-- <link rel="stylesheet" href="css/normalize.css"> -->
<!-- <link rel="stylesheet" href="css/envisioned.css"/> -->
<link rel="stylesheet" href="css/tablesaw-stackonly.css"/>
<link rel="stylesheet" href="css/nudge.css"/>
<link rel="stylesheet" href="css/sourcesans.css"/>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>




</head>

<body>

<!--bookdown:toc:start-->

<nav class="pushy pushy-left" id="TOC">
<ul>
<li><a href="#preface">Preface</a></li>
<li><a href="#acknowledgments">Acknowledgments</a></li>
<li><a href="#chapter-1.-introduction">Chapter 1. Introduction</a></li>
<li><a href="#chapter-2.-abstraction-regression-tree-models">Chapter 2. Abstraction: Regression &amp; Tree Models</a></li>
<li><a href="#chapter-3.-recognition-logistic-regression-ranking">Chapter 3. Recognition: Logistic Regression &amp; Ranking</a></li>
<li><a href="#chapter-4.-resonance-bootstrap-random-forests">Chapter 4. Resonance: Bootstrap &amp; Random Forests</a></li>
<li><a href="#chapter-5.-learning-i-cross-validation-oob">Chapter 5. Learning (I): Cross-validation &amp; OOB</a></li>
<li><a href="#chapter-6.-diagnosis-residuals-heterogeneity">Chapter 6. Diagnosis: Residuals &amp; Heterogeneity</a></li>
<li><a href="#chapter-7.-learning-ii-svm-ensemble-learning">Chapter 7. Learning (II): SVM &amp; Ensemble Learning</a></li>
<li><a href="#chapter-8.-scalability-lasso-pca">Chapter 8. Scalability: LASSO &amp; PCA</a></li>
<li><a href="#chapter-9.-pragmatism-experience-experimental">Chapter 9. Pragmatism: Experience &amp; Experimental</a></li>
<li><a href="#chapter-10.-synthesis-architecture-pipeline">Chapter 10. Synthesis: Architecture &amp; Pipeline</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#appendix-a-brief-review-of-background-knowledge">Appendix: A Brief Review of Background Knowledge</a></li>
</ul>
</nav>

<!--bookdown:toc:end-->

<div class="menu-btn"><h3>☰ Menu</h3></div>

<div class="site-overlay"></div>


<div class="row">
<div class="col-sm-12">

<nav class="pushy pushy-left" id="TOC">
<ul>
<li><a href="index.html#preface">Preface</a></li>
<li><a href="acknowledgments.html#acknowledgments">Acknowledgments</a></li>
<li><a href="chapter-1-introduction.html#chapter-1.-introduction">Chapter 1. Introduction</a></li>
<li><a href="chapter-2-abstraction-regression-tree-models.html#chapter-2.-abstraction-regression-tree-models">Chapter 2. Abstraction: Regression &amp; Tree Models</a></li>
<li><a href="chapter-3-recognition-logistic-regression-ranking.html#chapter-3.-recognition-logistic-regression-ranking">Chapter 3. Recognition: Logistic Regression &amp; Ranking</a></li>
<li><a href="chapter-4-resonance-bootstrap-random-forests.html#chapter-4.-resonance-bootstrap-random-forests">Chapter 4. Resonance: Bootstrap &amp; Random Forests</a></li>
<li><a href="chapter-5-learning-i-cross-validation-oob.html#chapter-5.-learning-i-cross-validation-oob">Chapter 5. Learning (I): Cross-validation &amp; OOB</a></li>
<li><a href="chapter-6-diagnosis-residuals-heterogeneity.html#chapter-6.-diagnosis-residuals-heterogeneity">Chapter 6. Diagnosis: Residuals &amp; Heterogeneity</a></li>
<li><a href="chapter-7-learning-ii-svm-ensemble-learning.html#chapter-7.-learning-ii-svm-ensemble-learning">Chapter 7. Learning (II): SVM &amp; Ensemble Learning</a></li>
<li><a href="chapter-8-scalability-lasso-pca.html#chapter-8.-scalability-lasso-pca">Chapter 8. Scalability: LASSO &amp; PCA</a></li>
<li><a href="chapter-9-pragmatism-experience-experimental.html#chapter-9.-pragmatism-experience-experimental">Chapter 9. Pragmatism: Experience &amp; Experimental</a></li>
<li><a href="chapter-10-synthesis-architecture-pipeline.html#chapter-10.-synthesis-architecture-pipeline">Chapter 10. Synthesis: Architecture &amp; Pipeline</a></li>
<li><a href="conclusion.html#conclusion">Conclusion</a></li>
<li><a href="appendix-a-brief-review-of-background-knowledge.html#appendix-a-brief-review-of-background-knowledge">Appendix: A Brief Review of Background Knowledge</a></li>
</ul>
</nav>

</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="conditional-variance-regression-model" class="section level2 unnumbered">
<h2>Conditional variance regression model</h2>
<div id="rationale-and-formulation-15" class="section level3 unnumbered">
<h3>Rationale and formulation</h3>
<p>Another common complication when applying linear regression model in real-world applications is that the variance of the response variable may also change. This phenomenon is called <strong>heteroscedasticity</strong> in regression analysis. This complication can be taken care of by a <em>conditional variance regression</em> model that allows the variance of the response variable to be a (usually implicit) function of the input variables. This leads to the following model</p>
<p><span class="math display" id="eq:9-cvr">\[\begin{equation}
    y=\boldsymbol{\beta}^T\boldsymbol{x}+\epsilon_{\boldsymbol{x}}, \epsilon_{\boldsymbol{x}} \sim N(0, \sigma^2_{\boldsymbol{x}}),
\tag{99}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\epsilon_{\boldsymbol{x}}\)</span> modeled as a normal distribution with <em>varying</em> variance as a function of <span class="math inline">\(\boldsymbol{x}\)</span>.</p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f9-cvr-datamodel"></span>
<img src="graphics/9_cvr_datamodel.png" alt="The *data-generating mechanism* of a conditional variance regression model" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 166: The <em>data-generating mechanism</em> of a conditional variance regression model<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f9-condsigma"></span>
<img src="graphics/9_condsigma.png" alt="$\sigma_{\boldsymbol{x}}$ is a function of $\boldsymbol{x}$" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 167: <span class="math inline">\(\sigma_{\boldsymbol{x}}\)</span> is a function of <span class="math inline">\(\boldsymbol{x}\)</span><!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>The conditional variance regression model differs from the regular linear regression model in terms of how it models <span class="math inline">\(\sigma_{\boldsymbol{x}}\)</span>, as illustrated in Figure <a href="conditional-variance-regression-model.html#fig:f9-cvr-datamodel">166</a>. In other words, the linear regression model is a special type of the conditional variance regression model, with <span class="math inline">\(\sigma_{\boldsymbol{x}}\)</span> being a fixed constant as the horizontal line shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-condsigma">167</a>. The conditional variance regression model is a stacked model with one regression model on <span class="math inline">\(y\)</span> and another model on <span class="math inline">\(\sigma_{\boldsymbol{x}}\)</span>. The model stacking is a common strategy in statistics to handle multi-layered problems.</p>
</div>
<div id="theory-and-method-10" class="section level3 unnumbered">
<h3>Theory and method</h3>
<p>Given a dataset with <span class="math inline">\(N\)</span> data points and <span class="math inline">\(p\)</span> variables</p>
<p><span class="math display">\[ 
\boldsymbol{y}=\left[ \begin{array}{c}{y_{1}} \\ {y_{2}} \\ {\vdots} \\ {y_{N}}\end{array}\right], \boldsymbol{X}=\left[ \begin{array}{ccccc}{1} &amp; {x_{11}} &amp; {x_{21}} &amp; {\cdots} &amp; {x_{p 1}} \\ {1} &amp; {x_{12}} &amp; {x_{22}} &amp; {\cdots} &amp; {x_{p 2}} \\ {\vdots} &amp; {\vdots} &amp; {\vdots} &amp; {\vdots} &amp; {\vdots} \\ {1} &amp; {x_{1 N}} &amp; {x_{2 N}} &amp; {\cdots} &amp; {x_{p N}}\end{array}\right].
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol y \in R^{N \times 1}\)</span> denotes the <span class="math inline">\(N\)</span> measurements of the outcome variable, and <span class="math inline">\(\boldsymbol{X} \in R^{N \times(p+1)}\)</span> denotes the data matrix that includes the <span class="math inline">\(N\)</span> measurements of the <span class="math inline">\(p\)</span> input variables and one dummy variable that corresponds to the intercept term <span class="math inline">\(\beta_0\)</span>. The remaining issue is how to estimate the regression parameters <span class="math inline">\(\boldsymbol{\beta}\)</span>. There are two situations: <span class="math inline">\(\sigma_{\boldsymbol{x}}^2\)</span> is known and <span class="math inline">\(\sigma_{\boldsymbol{x}}^2\)</span> is unknown.</p>
<p>The likelihood function is<label for="tufte-sn-235" class="margin-toggle sidenote-number">235</label><input type="checkbox" id="tufte-sn-235" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">235</span> Readers can use Eq. <a href="conditional-variance-regression-model.html#eq:9-cvr">(99)</a> to derive this likelihood function.</span>
<span class="math display">\[-\frac{\pi}{2} \ln 2 \pi-\frac{1}{2} \sum_{n=1}^{N} \log \sigma_{\boldsymbol x_{n}}^{2}-\frac{1}{2} \sum_{n=1}^{N} \frac{\left(y_{n}-\boldsymbol{\beta}^{T} \boldsymbol{x}_{n}\right)^{2}}{\sigma_{\boldsymbol x_{n}}^{2}}.\]</span></p>
<p>As we have known <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span>, the parameters to be estimated only involve the last part of the likelihood function. Thus, we estimate the parameters that minimize:
<span class="math display">\[\frac{1}{2} \sum_{n=1}^{N} \frac{\left(y_{n}-\boldsymbol{\beta}^{T} \boldsymbol{x}_{n}\right)^{2}}{\sigma_{\boldsymbol x_{n}}^{2}}.\]</span>
This could be written in the matrix form as<label for="tufte-sn-236" class="margin-toggle sidenote-number">236</label><input type="checkbox" id="tufte-sn-236" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">236</span> <span class="math inline">\(\boldsymbol W\)</span> is a diagonal matrix with its diagonal elements as <span class="math inline">\(\boldsymbol W_{nn}=\frac{1}{\sigma_{\boldsymbol x_n}^2}\)</span>.</span></p>
<p><span class="math display" id="eq:9-condivar-gls">\[\begin{equation}
    \min_\beta (\boldsymbol{y}-\boldsymbol{X \beta})^T\boldsymbol{W}(\boldsymbol{y}-\boldsymbol{X\beta}).
\tag{100}
\end{equation}\]</span></p>
<p>This has the same structure as the <em>generalized least squares (GLS)</em> problem we have mentioned in <strong>Chapter 3</strong>. To solve this optimization problem, we take the gradient of the objective function in Eq. <a href="conditional-variance-regression-model.html#eq:9-condivar-gls">(100)</a> and set it to be zero</p>
<p><span class="math display">\[\frac{\partial (\boldsymbol{y}-\boldsymbol{\mathrm{X} \beta})^T\boldsymbol{W}(\boldsymbol{y}-\boldsymbol{ X\beta})}{\partial \boldsymbol \beta}=0,\]</span></p>
<p>which gives rise to the equation</p>
<p><span class="math display">\[\boldsymbol{X}^T \boldsymbol W (\boldsymbol y - \boldsymbol{X} \boldsymbol \beta) = 0.\]</span></p>
<p>This leads to the GLS estimator of <span class="math inline">\(\boldsymbol \beta\)</span></p>
<p><span class="math display" id="eq:9-gls">\[\begin{equation}
    \hat{\boldsymbol{\beta}} = (\boldsymbol{X}^T\boldsymbol{WX} )^{-1}\boldsymbol{X}^T \boldsymbol{W} \boldsymbol y.
\tag{101}
\end{equation}\]</span></p>
<p>A more complicated situation, also a more realistic one, is that we don’t know <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span>. If we can estimate <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span>, we can reuse the procedure we have developed for the case when we have known <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span>.</p>
<p>As shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-condsigma">167</a>, <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span> is a function of <span class="math inline">\(\boldsymbol x\)</span>. In other words, it uses the input variables <span class="math inline">\(\boldsymbol x\)</span> to predict a new outcome variable, <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span>. Isn’t this a regression problem? The problem here is we don’t have the “measurements” of the outcome variable, i.e., the outcome variable <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span> is not directly measurable<label for="tufte-sn-237" class="margin-toggle sidenote-number">237</label><input type="checkbox" id="tufte-sn-237" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">237</span> Another example of a <strong>latent variable</strong> .</span>.</p>
<p>To overcome this problem, we estimate the <em>measurements</em> of the latent variable<label for="tufte-sn-238" class="margin-toggle sidenote-number">238</label><input type="checkbox" id="tufte-sn-238" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">238</span> I.e., just like what we did in the EM algorithm to estimate <span class="math inline">\(z_{nm}\)</span>. See <strong>Chapter 6</strong>.</span>, denoted as <span class="math inline">\(\hat{\sigma}_{\boldsymbol{x}_n}^2\)</span> for <span class="math inline">\(n=1, 2, \dots, N\)</span>. We propose the following steps:</p>
<p><!-- begin{enumerate} --></p>
<ul>
<li><p> Initialize <span class="math inline">\(\hat{\sigma}_{\boldsymbol{x}_n}^2\)</span> for <span class="math inline">\(n=1, 2, \dots, N\)</span> by any reasonable approach (i.e., a trivial but popular approach, randomization).</p></li>
<li><p> Estimate <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> using the GLS estimator shown in Eq. <a href="conditional-variance-regression-model.html#eq:9-gls">(101)</a>, and get <span class="math inline">\(\hat{y}_n=\hat{\boldsymbol \beta}^T \boldsymbol{x}_n\)</span> for <span class="math inline">\(n=1, 2, \dots, N\)</span>.</p></li>
<li><p> Derive the residuals <span class="math inline">\(\hat{\epsilon}_n = y_n-\hat{y}_n\)</span> for <span class="math inline">\(n=1, 2, \dots, N\)</span>.</p></li>
<li><p> Build a regression model, e.g., using the kernel regression model, to fit <span class="math inline">\(\hat \epsilon\)</span> using <span class="math inline">\(\boldsymbol x\)</span>.<label for="tufte-sn-239" class="margin-toggle sidenote-number">239</label><input type="checkbox" id="tufte-sn-239" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">239</span> I.e., the training dataset is <span class="math inline">\(\{\boldsymbol x_n, \hat{\epsilon}_n, n=1, 2, \dots, N\}\)</span>.</span></p></li>
<li><p> Predict <span class="math inline">\(\hat{\sigma}^2_{\boldsymbol x_n}\)</span> for <span class="math inline">\(n=1,2,\dots,N\)</span> using the fitted model in Step 4.</p></li>
<li><p> Repeat Steps 2 – 5 until convergence or satisfaction of a stopping criteria<label for="tufte-sn-240" class="margin-toggle sidenote-number">240</label><input type="checkbox" id="tufte-sn-240" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">240</span> E.g., fix the number of iterations, or set a threshold for changes in the parameter estimation.</span>.</p></li>
</ul>
<p><!-- end{enumerate} --></p>
<p>This approach of taking some variables as latent variables and further using statistical estimation/inference to fill in the unseen measurements has been useful in statistics and used in many models, such as the latent factor models, structural equation models, missing values imputation, EM algorithm, Gaussian mixture model, graphical models with latent variables, etc.</p>
</div>
<div id="r-lab-14" class="section level3 unnumbered">
<h3>R Lab</h3>
<p><em>Simulation Experiment.</em> We simulate a dataset to see how well the proposed iterative procedure works for the parameter estimation when <span class="math inline">\(\sigma_{\boldsymbol x}^2\)</span> is unknown. The simulated data has one predictor and one outcome variable. The true model is</p>
<p><span class="math display">\[
  y = 1 + 0.5 x + \epsilon_x, \quad \sigma^2_x = 0.5 + 0.8 x^2.
\]</span></p>
<p>We stimulate <span class="math inline">\(100\)</span> data points from this model using the R script shown below.</p>
<p></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="conditional-variance-regression-model.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditional variance function</span></span>
<span id="cb198-2"><a href="conditional-variance-regression-model.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a regression model with heterogeneous variance</span></span>
<span id="cb198-3"><a href="conditional-variance-regression-model.html#cb198-3" aria-hidden="true" tabindex="-1"></a>gen_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n, coef) {</span>
<span id="cb198-4"><a href="conditional-variance-regression-model.html#cb198-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb198-5"><a href="conditional-variance-regression-model.html#cb198-5" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="dv">0</span>,<span class="fu">sapply</span>(x,<span class="cf">function</span>(x){<span class="fl">0.5+0.8</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>}))</span>
<span id="cb198-6"><a href="conditional-variance-regression-model.html#cb198-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>,x)</span>
<span id="cb198-7"><a href="conditional-variance-regression-model.html#cb198-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(X <span class="sc">%*%</span> coef <span class="sc">+</span> eps)</span>
<span id="cb198-8"><a href="conditional-variance-regression-model.html#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))</span>
<span id="cb198-9"><a href="conditional-variance-regression-model.html#cb198-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb198-10"><a href="conditional-variance-regression-model.html#cb198-10" aria-hidden="true" tabindex="-1"></a>n_train <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb198-11"><a href="conditional-variance-regression-model.html#cb198-11" aria-hidden="true" tabindex="-1"></a>coef <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb198-12"><a href="conditional-variance-regression-model.html#cb198-12" aria-hidden="true" tabindex="-1"></a>tempData <span class="ot">&lt;-</span> <span class="fu">gen_data</span>(n_train, coef)</span></code></pre></div>
<p></p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f9-4"></span>
<img src="graphics/9_4.png" alt="Linear regression model to fit a heteroscedastic dataset" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 168: Linear regression model to fit a heteroscedastic dataset<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>The simulated data points are shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-4">168</a>, together with the true model (the black line).</p>
<p>To initialize the iterative procedure of parameter estimation for the conditional variance regression model, we fit a regular linear regression model using the following R code.</p>
<p></p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="conditional-variance-regression-model.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the data using linear regression model (OLS)</span></span>
<span id="cb199-2"><a href="conditional-variance-regression-model.html#cb199-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> tempData[, <span class="st">&quot;x&quot;</span>]</span>
<span id="cb199-3"><a href="conditional-variance-regression-model.html#cb199-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> tempData[, <span class="st">&quot;y&quot;</span>]</span>
<span id="cb199-4"><a href="conditional-variance-regression-model.html#cb199-4" aria-hidden="true" tabindex="-1"></a>fit.ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x,<span class="at">data=</span>tempData)</span>
<span id="cb199-5"><a href="conditional-variance-regression-model.html#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data and the models</span></span>
<span id="cb199-6"><a href="conditional-variance-regression-model.html#cb199-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> tempData<span class="sc">$</span>x</span>
<span id="cb199-7"><a href="conditional-variance-regression-model.html#cb199-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, x)</span>
<span id="cb199-8"><a href="conditional-variance-regression-model.html#cb199-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> tempData<span class="sc">$</span>y</span>
<span id="cb199-9"><a href="conditional-variance-regression-model.html#cb199-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x, <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb199-10"><a href="conditional-variance-regression-model.html#cb199-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the true model</span></span>
<span id="cb199-11"><a href="conditional-variance-regression-model.html#cb199-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, X <span class="sc">%*%</span> coef, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb199-12"><a href="conditional-variance-regression-model.html#cb199-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the linear regression model (OLS)</span></span>
<span id="cb199-13"><a href="conditional-variance-regression-model.html#cb199-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">fitted</span>(fit.ols), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb199-14"><a href="conditional-variance-regression-model.html#cb199-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;True function&quot;</span>,</span>
<span id="cb199-15"><a href="conditional-variance-regression-model.html#cb199-15" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;Linear model (OLS)&quot;</span>), </span>
<span id="cb199-16"><a href="conditional-variance-regression-model.html#cb199-16" aria-hidden="true" tabindex="-1"></a><span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;darkorange&quot;</span>),</span>
<span id="cb199-17"><a href="conditional-variance-regression-model.html#cb199-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">text.width =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span></code></pre></div>
<p></p>
<p>The fitted line is shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-4">168</a>, which has a significant deviation from the true regression model. We use the fitted line as a starting point, i.e., so that we can estimate the residuals<label for="tufte-sn-241" class="margin-toggle sidenote-number">241</label><input type="checkbox" id="tufte-sn-241" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">241</span>  Residuals <span class="math inline">\(\hat{\epsilon}_n = y_n-\hat{y}_n\)</span> for <span class="math inline">\(n=1, 2, \dots, N\)</span>.</span> based on the fitted linear regression model. The estimated residuals are plotted in Figure <a href="conditional-variance-regression-model.html#fig:f9-5">169</a> as grey dots. A nonlinear regression model, the kernel regression model implemented by <code>npreg()</code>, is fitted on these residuals and shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-5">169</a> as the orange curve. The true function of the variance, i.e., <span class="math inline">\(\sigma^2_x = 0.5 + 0.8 x^2\)</span>, is also shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-5">169</a> as the black curve.</p>
<p>It can be seen that the residuals provide a good starting point for us to approximate the underlying true variance function. To reproduce Figure <a href="conditional-variance-regression-model.html#fig:f9-5">169</a>, use the following R script.</p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f9-5"></span>
<img src="graphics/9_5.png" alt="Nonlinear regression model to fit the residuals (i.e., the grey dots)" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 169: Nonlinear regression model to fit the residuals (i.e., the grey dots)<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="conditional-variance-regression-model.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the residual estimated from the linear regression model (OLS)</span></span>
<span id="cb200-2"><a href="conditional-variance-regression-model.html#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">residuals</span>(fit.ols)<span class="sc">^</span><span class="dv">2</span>,<span class="at">ylab=</span><span class="st">&quot;squared residuals&quot;</span>,</span>
<span id="cb200-3"><a href="conditional-variance-regression-model.html#cb200-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb200-4"><a href="conditional-variance-regression-model.html#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the true model underlying the variance of the</span></span>
<span id="cb200-5"><a href="conditional-variance-regression-model.html#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="co"># error term</span></span>
<span id="cb200-6"><a href="conditional-variance-regression-model.html#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>((<span class="dv">1</span><span class="fl">+0.8</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>,<span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb200-7"><a href="conditional-variance-regression-model.html#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a nonlinear regression model for residuals</span></span>
<span id="cb200-8"><a href="conditional-variance-regression-model.html#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;np&quot;)</span></span>
<span id="cb200-9"><a href="conditional-variance-regression-model.html#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(np)</span>
<span id="cb200-10"><a href="conditional-variance-regression-model.html#cb200-10" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">npreg</span>(<span class="fu">residuals</span>(fit.ols)<span class="sc">^</span><span class="dv">2</span> <span class="sc">~</span> x)</span>
<span id="cb200-11"><a href="conditional-variance-regression-model.html#cb200-11" aria-hidden="true" tabindex="-1"></a>grid.x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(x),<span class="at">to=</span><span class="fu">max</span>(x),<span class="at">length.out=</span><span class="dv">300</span>)</span>
<span id="cb200-12"><a href="conditional-variance-regression-model.html#cb200-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(grid.x,<span class="fu">predict</span>(var1,<span class="at">exdat=</span>grid.x), <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb200-13"><a href="conditional-variance-regression-model.html#cb200-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb200-14"><a href="conditional-variance-regression-model.html#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb200-15"><a href="conditional-variance-regression-model.html#cb200-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;True function&quot;</span>,</span>
<span id="cb200-16"><a href="conditional-variance-regression-model.html#cb200-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Fitted nonlinear model (1st iter)&quot;</span>), </span>
<span id="cb200-17"><a href="conditional-variance-regression-model.html#cb200-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;darkorange&quot;</span>),</span>
<span id="cb200-18"><a href="conditional-variance-regression-model.html#cb200-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">text.width =</span> <span class="dv">5</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p></p>
<p>The orange curve shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-5">169</a> provides an approach to initialize the iterative procedure of parameter estimation for the conditional variance regression model: to estimate the <span class="math inline">\(\hat{\sigma}_{\boldsymbol{x}_n}^2\)</span> for <span class="math inline">\(n=1, 2, \dots, N\)</span> in Step 1.<label for="tufte-sn-242" class="margin-toggle sidenote-number">242</label><input type="checkbox" id="tufte-sn-242" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">242</span> In R, this is done by <code>fitted(var1)</code>.</span> Then, for Step 2, we fit a linear regression model according to Eq. <a href="conditional-variance-regression-model.html#eq:9-gls">(101)</a>. This is done by the following R code.</p>
<p></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="conditional-variance-regression-model.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a linear regression model (WLS) with the weights specified </span></span>
<span id="cb201-2"><a href="conditional-variance-regression-model.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by the fitted nonlinear model of the residuals</span></span>
<span id="cb201-3"><a href="conditional-variance-regression-model.html#cb201-3" aria-hidden="true" tabindex="-1"></a>fit.wls <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x,<span class="at">weights=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">fitted</span>(var1))</span>
<span id="cb201-4"><a href="conditional-variance-regression-model.html#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x, <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">20</span>))</span>
<span id="cb201-5"><a href="conditional-variance-regression-model.html#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the true model</span></span>
<span id="cb201-6"><a href="conditional-variance-regression-model.html#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, X <span class="sc">%*%</span> coef, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb201-7"><a href="conditional-variance-regression-model.html#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the linear regression model (OLS)</span></span>
<span id="cb201-8"><a href="conditional-variance-regression-model.html#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">fitted</span>(fit.ols), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb201-9"><a href="conditional-variance-regression-model.html#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the linear regression model (WLS) with estimated </span></span>
<span id="cb201-10"><a href="conditional-variance-regression-model.html#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="co"># variance function</span></span>
<span id="cb201-11"><a href="conditional-variance-regression-model.html#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">fitted</span>(fit.wls), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;forestgreen&quot;</span>)</span>
<span id="cb201-12"><a href="conditional-variance-regression-model.html#cb201-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb201-13"><a href="conditional-variance-regression-model.html#cb201-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;True function&quot;</span>, <span class="st">&quot;Linear (OLS)&quot;</span>, </span>
<span id="cb201-14"><a href="conditional-variance-regression-model.html#cb201-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Linear (WLS) + estimated variance&quot;</span>), </span>
<span id="cb201-15"><a href="conditional-variance-regression-model.html#cb201-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>), </span>
<span id="cb201-16"><a href="conditional-variance-regression-model.html#cb201-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;darkorange&quot;</span>,<span class="st">&quot;forestgreen&quot;</span>),</span>
<span id="cb201-17"><a href="conditional-variance-regression-model.html#cb201-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">text.width =</span> <span class="dv">5</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span></code></pre></div>
<p></p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f9-6"></span>
<img src="graphics/9_6.png" alt="Fit the heteroscedastic dataset with two linear regression models using OLS and GLS (that accounts for the heteroscedastic effects with a nonlinear regression model to model the variance regression)" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 170: Fit the heteroscedastic dataset with two linear regression models using OLS and GLS (that accounts for the heteroscedastic effects with a nonlinear regression model to model the variance regression)<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>The new regression model is added to Figure <a href="conditional-variance-regression-model.html#fig:f9-4">168</a> as the green line, which generates Figure <a href="conditional-variance-regression-model.html#fig:f9-6">170</a>. The new regression model is closer to the true model.</p>
<p>And we could continue this iterative procedure until a convergence criterion is met.</p>
<p><em>Real data.</em> Now let’s apply the conditional variance regression model on the AD dataset. Like what we did in the simulation experiment, we first fit a regular linear regression model, then, use the kernel regression model to fit the residuals, then obtain the estimates of the variances, then estimate the regression parameters using Eq. <a href="conditional-variance-regression-model.html#eq:9-gls">(101)</a>. The R code is shown below. Results are shown in Figure <a href="conditional-variance-regression-model.html#fig:f9-8">171</a>.</p>
<p></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="conditional-variance-regression-model.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RCurl)</span>
<span id="cb202-2"><a href="conditional-variance-regression-model.html#cb202-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;https://raw.githubusercontent.com&quot;</span>,</span>
<span id="cb202-3"><a href="conditional-variance-regression-model.html#cb202-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;/analyticsbook/book/main/data/AD.csv&quot;</span>)</span>
<span id="cb202-4"><a href="conditional-variance-regression-model.html#cb202-4" aria-hidden="true" tabindex="-1"></a>AD <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">text=</span><span class="fu">getURL</span>(url))</span>
<span id="cb202-5"><a href="conditional-variance-regression-model.html#cb202-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-6"><a href="conditional-variance-regression-model.html#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(AD)</span>
<span id="cb202-7"><a href="conditional-variance-regression-model.html#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the data using linear regression model (OLS)</span></span>
<span id="cb202-8"><a href="conditional-variance-regression-model.html#cb202-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> AD<span class="sc">$</span>HippoNV</span>
<span id="cb202-9"><a href="conditional-variance-regression-model.html#cb202-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> AD<span class="sc">$</span>MMSCORE</span>
<span id="cb202-10"><a href="conditional-variance-regression-model.html#cb202-10" aria-hidden="true" tabindex="-1"></a>fit.ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x,<span class="at">data=</span>AD)</span>
<span id="cb202-11"><a href="conditional-variance-regression-model.html#cb202-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a linear regression model (WLS) with the weights specified </span></span>
<span id="cb202-12"><a href="conditional-variance-regression-model.html#cb202-12" aria-hidden="true" tabindex="-1"></a><span class="co"># by the fitted nonlinear model of the residuals</span></span>
<span id="cb202-13"><a href="conditional-variance-regression-model.html#cb202-13" aria-hidden="true" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> <span class="fu">npreg</span>(<span class="fu">residuals</span>(fit.ols)<span class="sc">^</span><span class="dv">2</span> <span class="sc">~</span> HippoNV, <span class="at">data =</span> AD)         </span>
<span id="cb202-14"><a href="conditional-variance-regression-model.html#cb202-14" aria-hidden="true" tabindex="-1"></a>fit.wls <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x,<span class="at">weights=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">fitted</span>(var1))</span>
<span id="cb202-15"><a href="conditional-variance-regression-model.html#cb202-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x, <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb202-16"><a href="conditional-variance-regression-model.html#cb202-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the linear regression model (OLS)</span></span>
<span id="cb202-17"><a href="conditional-variance-regression-model.html#cb202-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">fitted</span>(fit.ols), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb202-18"><a href="conditional-variance-regression-model.html#cb202-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the linear regression model (WLS) with estimated variance</span></span>
<span id="cb202-19"><a href="conditional-variance-regression-model.html#cb202-19" aria-hidden="true" tabindex="-1"></a><span class="co"># function</span></span>
<span id="cb202-20"><a href="conditional-variance-regression-model.html#cb202-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">fitted</span>(fit.wls), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;forestgreen&quot;</span>)</span>
<span id="cb202-21"><a href="conditional-variance-regression-model.html#cb202-21" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb202-22"><a href="conditional-variance-regression-model.html#cb202-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Linear (OLS)&quot;</span>,</span>
<span id="cb202-23"><a href="conditional-variance-regression-model.html#cb202-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;Linear (WLS) + estimated variance&quot;</span>), </span>
<span id="cb202-24"><a href="conditional-variance-regression-model.html#cb202-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkorange&quot;</span>,<span class="st">&quot;forestgreen&quot;</span>),</span>
<span id="cb202-25"><a href="conditional-variance-regression-model.html#cb202-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">text.width =</span> <span class="fl">0.2</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span></code></pre></div>
<p></p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f9-8"></span>
<img src="graphics/9_8.png" alt="Fit the AD dataset with two linear regression models using OLS and GLS (that accounts for the heteroscedastic effects with a nonlinear regression model to model the variance regression)" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 171: Fit the AD dataset with two linear regression models using OLS and GLS (that accounts for the heteroscedastic effects with a nonlinear regression model to model the variance regression)<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<p>We also visualize the fitted variance functions in Figure <a href="conditional-variance-regression-model.html#fig:f9-9">172</a> via the following R code.</p>
<p></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="conditional-variance-regression-model.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the residual estimated from the linear regression </span></span>
<span id="cb203-2"><a href="conditional-variance-regression-model.html#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="co"># model (OLS)</span></span>
<span id="cb203-3"><a href="conditional-variance-regression-model.html#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">residuals</span>(fit.ols)<span class="sc">^</span><span class="dv">2</span>,<span class="at">ylab=</span><span class="st">&quot;squared residuals&quot;</span>,</span>
<span id="cb203-4"><a href="conditional-variance-regression-model.html#cb203-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb203-5"><a href="conditional-variance-regression-model.html#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a nonlinear regression model for residuals</span></span>
<span id="cb203-6"><a href="conditional-variance-regression-model.html#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;np&quot;)</span></span>
<span id="cb203-7"><a href="conditional-variance-regression-model.html#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(np)</span>
<span id="cb203-8"><a href="conditional-variance-regression-model.html#cb203-8" aria-hidden="true" tabindex="-1"></a>var2 <span class="ot">&lt;-</span> <span class="fu">npreg</span>(<span class="fu">residuals</span>(fit.wls)<span class="sc">^</span><span class="dv">2</span> <span class="sc">~</span> x)</span>
<span id="cb203-9"><a href="conditional-variance-regression-model.html#cb203-9" aria-hidden="true" tabindex="-1"></a>grid.x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fu">min</span>(x),<span class="at">to=</span><span class="fu">max</span>(x),<span class="at">length.out=</span><span class="dv">300</span>)</span>
<span id="cb203-10"><a href="conditional-variance-regression-model.html#cb203-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(grid.x,<span class="fu">predict</span>(var1,<span class="at">exdat=</span>grid.x), <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb203-11"><a href="conditional-variance-regression-model.html#cb203-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb203-12"><a href="conditional-variance-regression-model.html#cb203-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(grid.x,<span class="fu">predict</span>(var2,<span class="at">exdat=</span>grid.x), <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb203-13"><a href="conditional-variance-regression-model.html#cb203-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;forestgreen&quot;</span>)</span>
<span id="cb203-14"><a href="conditional-variance-regression-model.html#cb203-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb203-15"><a href="conditional-variance-regression-model.html#cb203-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Fitted nonlinear model (1st iter)&quot;</span>,</span>
<span id="cb203-16"><a href="conditional-variance-regression-model.html#cb203-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Fitted nonlinear model (2nd iter)&quot;</span>), </span>
<span id="cb203-17"><a href="conditional-variance-regression-model.html#cb203-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb203-18"><a href="conditional-variance-regression-model.html#cb203-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="fu">c</span>( <span class="st">&quot;darkorange&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>),</span>
<span id="cb203-19"><a href="conditional-variance-regression-model.html#cb203-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">text.width =</span> <span class="fl">0.25</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p></p>
<p>Figure <a href="conditional-variance-regression-model.html#fig:f9-9">172</a> shows that in the data the heteroscedasticity is significant. Learning the variance function is helpful in this context. First, in terms of the statistical aspect, it improves the fitting of the regression line. Second, knowing the variance function itself is important knowledge in healthcare, e.g., variance often implies unpredictability or low quality in healthcare operations, pointing out root causes of quality problems or areas of improvement.</p>
<p></p>
<p>
<span class="marginnote shownote">
<!--
<div class="figure">--><span id="fig:f9-9"></span>
<img src="graphics/9_9.png" alt="Nonlinear regression model to fit the residuals in the 2nd iteration for the AD data" width="250px"  />
<!--
<p class="caption marginnote">-->Figure 172: Nonlinear regression model to fit the residuals in the 2nd iteration for the AD data<!--</p>-->
<!--</div>--></span>
</p>
<p></p>
<div style="page-break-after: always;"></div>
</div>
</div>
<p style="text-align: center;">
<a href="kernel-regression-model.html"><button class="btn btn-default">Previous</button></a>
<a href="remarks-7.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>

<script src="js/jquery.js"></script>
<script src="js/tablesaw-stackonly.js"></script>
<script src="js/nudge.min.js"></script>


<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
